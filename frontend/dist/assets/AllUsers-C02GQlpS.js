import{r as c,u as Z,j as e,p as B,q as L,S as I,D as _,c as S,B as i}from"./index-B1gsUCrx.js";const U="https://ees121.com",z=({user:t,onClose:$,onApprove:A})=>{var N,f,w,v,u;const[b,m]=c.useState(null),[p,h]=c.useState(t.permanentAddress||""),[j,P]=c.useState(t.aadharNumber||""),[g,C]=c.useState(!1),[k,D]=c.useState(t._id),y=[t.frontAadhar,t.backAadhar];if(!t)return null;const s=n=>{n.stopPropagation(),A(t._id)},r=async()=>{var n,x,E;console.log(p,j,k,"permanentAddress, aadharNumber");try{C(!0);const o=await S.put(`${U}/auth/updateUserAddressAndAadhar`,{permanentAddress:p,aadharNumber:j,userId:k});console.log(o.data),o.status===200&&i.success((n=o==null?void 0:o.data)==null?void 0:n.message)}catch(o){console.log("Error updating user details:",o),i.error(((E=(x=o==null?void 0:o.response)==null?void 0:x.data)==null?void 0:E.message)||"Failed to update user details")}finally{C(!1)}},a=n=>{m(n)},l=()=>{m(null)},d=n=>{m(x=>(x+n+y.length)%y.length)};return e.jsxs("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:[e.jsxs("div",{className:"modal-content bg-white p-2 rounded shadow-lg w-full sm:w-3/4 md:w-1/2 lg:w-1/3 max-w-4xl h-[80vh] overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-bold py-3 text-center border",children:"User Details"}),e.jsx("div",{className:"modal-body overflow-y-auto",children:e.jsx("table",{className:"table-auto w-full border-collapse border border-gray-300",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"ProfilePic"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:e.jsx("img",{src:t.profilePic,width:50,alt:"Profile"})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.name})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Email"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.email})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Contact"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.phone})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:`${(N=t==null?void 0:t.address)==null?void 0:N.area} ${(f=t==null?void 0:t.address)==null?void 0:f.city} ${(w=t==null?void 0:t.address)==null?void 0:w.state} ${(v=t==null?void 0:t.address)==null?void 0:v.country} ${(u=t==null?void 0:t.address)==null?void 0:u.pincode}`})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessName})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Category"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessCategory})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessAddress})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2 flex gap-2",children:y.map((n,x)=>e.jsx("img",{src:n,width:50,alt:`Aadhar ${x+1}`,className:"cursor-pointer",onClick:()=>a(x)},x))})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Permanent Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:p})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar Number"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:j})]})]})})}),e.jsxs("div",{className:"flex justify-between mt-4 gap-1",children:[e.jsx("button",{onClick:s,className:"btn btn-primary w-full sm:w-auto",children:"Approve"}),e.jsx("button",{onClick:$,className:"btn btn-secondary w-full sm:w-auto",children:"Close"})]})]}),b!==null&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-[60]",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg flex relative",children:[e.jsx("button",{onClick:l,className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:"✖"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>d(-1),className:"px-4 py-2 bg-gray-300 rounded",children:"⬅"}),e.jsx("img",{src:y[b],className:"max-w-[70%] max-h-[90vh] object-contain mx-4",alt:"Zoomed Aadhar"}),e.jsx("button",{onClick:()=>d(1),className:"px-4 py-2 bg-gray-300 rounded",children:"➡"})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-1/3 p-4",children:[e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Aadhar Number",value:j,onChange:n=>P(n.target.value)}),e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Permanent Address",value:p,onChange:n=>h(n.target.value)}),e.jsx("button",{onClick:r,className:"bg-blue-500 text-white px-4 py-2 rounded",disabled:g,children:g?"Saving...":"Save"})]})]})})]})},R=()=>{const[t,$]=c.useState([]),[A,b]=c.useState(null),[m,p]=c.useState(""),[h,j]=c.useState(""),P=Z(),g=async()=>{var s,r;try{const a=await S.get(`${U}/auth/getAllUser`);console.log(a.data,"response.data");const l=a.data.user.filter(d=>d.isAdminApproved===!0);$(l)}catch(a){console.error("Error:",a.message),i((r=(s=a==null?void 0:a.response)==null?void 0:s.data)==null?void 0:r.message)}},C=async s=>{i.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete?"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>k(s),children:"Yes"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:i.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},k=async s=>{var r,a,l;i.dismiss();try{const d=await S.delete(`${U}/auth/deleteUser`,{headers:{"Content-Type":"application/json"},data:{id:s}});d.status===200&&(i((r=d==null?void 0:d.data)==null?void 0:r.message),g())}catch(d){console.error("Error:",d.message),i((l=(a=d==null?void 0:d.response)==null?void 0:a.data)==null?void 0:l.message)}};c.useEffect(()=>{g()},[]);const D=t.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.email.toLowerCase().includes(m.toLowerCase())||s.phone.includes(m)).sort((s,r)=>h==="A-Z"?r.name.localeCompare(s.name):h==="Z-A"?s.name.localeCompare(r.name):h==="oldest-newest"?new Date(r.createdAt)-new Date(s.createdAt):h==="newest-oldest"?new Date(s.createdAt)-new Date(r.createdAt):0),y=async s=>{var r,a;if(console.log(s,"referredById"),!!s)try{const l=await S.get(`${U}/auth/getUserById/${s}`);b(l.data.user)}catch(l){console.error("Error fetching referred user:",l.message),i(((a=(r=l==null?void 0:l.response)==null?void 0:r.data)==null?void 0:a.message)||"Failed to fetch referred user details")}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx(L,{}),e.jsxs("div",{className:"my-32",children:[e.jsx("section",{children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"card bg-base-100 shadow-xl mt-5",children:[e.jsx("div",{className:"card-header text-xl font-bold py-3",children:"All Users"}),e.jsxs("div",{className:"p-3",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by Name, Email, or Phone",value:m,onChange:s=>p(s.target.value)}),e.jsxs("select",{className:"form-select mt-2",value:h,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"",children:"Sort By"}),e.jsx("option",{value:"A-Z",children:"A-Z"}),e.jsx("option",{value:"Z-A",children:"Z-A"}),e.jsx("option",{value:"oldest-newest",children:"Oldest-Newest"}),e.jsx("option",{value:"newest-oldest",children:"Newest-Oldest"})]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table table-bordered border",children:[e.jsx("thead",{className:"text-bold text-[15px] text-black bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{children:"SrNo"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Referred By"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Action"})]})}),e.jsx("tbody",{children:D.reverse().map((s,r)=>{var a,l,d,N,f,w,v;return e.jsxs("tr",{children:[e.jsx("th",{children:r+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.phone}),e.jsx("td",{children:`${(a=s==null?void 0:s.address)==null?void 0:a.area}, ${(l=s==null?void 0:s.address)==null?void 0:l.city}, ${(d=s==null?void 0:s.address)==null?void 0:d.state}, ${(N=s==null?void 0:s.address)==null?void 0:N.country}, ${(f=s==null?void 0:s.address)==null?void 0:f.pincode}`}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-light border border-gray-300 btn-sm",onClick:()=>{var u;return y((u=s==null?void 0:s.referredBy[0])==null?void 0:u._id)},children:((w=s==null?void 0:s.referredBy)==null?void 0:w.length)>0?(v=s==null?void 0:s.referredBy[0])==null?void 0:v.name:"N/A"})}),e.jsx("td",{children:s.paymentVerified?e.jsx("button",{className:"btn btn-success btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment ",e.jsx(I,{})]})}):e.jsx("button",{className:"btn btn-danger btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment ",e.jsx(_,{size:17,className:""})]})})}),e.jsxs("td",{className:"d-flex",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>b(s),children:"Details"}),e.jsx("button",{className:"btn btn-danger btn-sm ml-2",onClick:()=>C(s._id),children:"Delete"}),e.jsx("button",{className:"btn btn-warning text-white btn-sm ml-2",onClick:()=>P("/admin/editUser",{state:s}),children:"Edit"})]})]},s._id)})})]})})]})})}),A&&e.jsx(z,{user:A,onClose:()=>b(null)})]})]})};export{R as default};
