import{r as h,u as L,j as e,p as I,q as z,S as R,E as _,L as F,c as C,B as i}from"./index-DuESt0g0.js";const k="https://ees121.com",T=({user:a,onClose:S,onApprove:U})=>{var u,v,w,Z,B;const[p,m]=h.useState(null),[$,x]=h.useState(!1),[j,D]=h.useState(a.permanentAddress||""),[b,E]=h.useState(a.aadharNumber||""),[g,y]=h.useState(!1),[f,s]=h.useState(a._id),t=[a.frontAadhar,a.backAadhar];if(!a)return null;const r=async()=>{var c,o,A;console.log(j,b,f,"permanentAddress, aadharNumber");try{y(!0);const d=await C.put(`${k}/auth/updateUserAddressAndAadhar`,{permanentAddress:j,aadharNumber:b,userId:f});console.log(d.data),d.status===200&&i.success((c=d==null?void 0:d.data)==null?void 0:c.message)}catch(d){console.log("Error updating user details:",d),i.error(((A=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:A.message)||"Failed to update user details")}finally{y(!1)}},l=c=>{m(c)},n=()=>{m(null)},N=c=>{m(o=>(o+c+t.length)%t.length)},P=async()=>{var c,o,A;try{y(!0);const d=await C.delete(`${k}/auth/delete-aadhar`,{data:{userId:f}});d.status===200&&(i.success((c=d==null?void 0:d.data)==null?void 0:c.message),S())}catch(d){console.error("Error deleting Aadhar:",d),i.error(((A=(o=d==null?void 0:d.response)==null?void 0:o.data)==null?void 0:A.message)||"Failed to delete Aadhar images")}finally{y(!1)}};return e.jsxs("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:[e.jsxs("div",{className:"modal-content bg-white p-2 rounded shadow-lg w-full sm:w-3/4 md:w-1/2 lg:w-1/3 max-w-4xl h-[80vh] overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-bold py-3 text-center border",children:"User Details"}),e.jsx("div",{className:"modal-body overflow-y-auto",children:e.jsx("table",{className:"table-auto w-full border-collapse border border-gray-300 bg-light",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"ProfilePic"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:e.jsx("img",{src:a.profilePic,width:50,alt:"Profile",className:"cursor-pointer",onClick:()=>x(!0)})})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:a.name})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Email"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:a.email})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Contact"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:a.phone})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:`${(u=a==null?void 0:a.address)==null?void 0:u.area} ${(v=a==null?void 0:a.address)==null?void 0:v.city} ${(w=a==null?void 0:a.address)==null?void 0:w.state} ${(Z=a==null?void 0:a.address)==null?void 0:Z.country} ${(B=a==null?void 0:a.address)==null?void 0:B.pincode}`})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:a.businessName})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Category"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:a.businessCategory})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:a.businessAddress})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex gap-2",children:[t.filter(Boolean).length>0?e.jsx("div",{className:"flex gap-2",children:t.map((c,o)=>c&&e.jsx("img",{src:c,width:50,alt:`Aadhar ${o+1}`,className:"cursor-pointer",onClick:()=>l(o)},o))}):e.jsx("span",{className:"text-red-500",children:"Photos Deleted"}),t.filter(Boolean).length>0&&e.jsx("div",{className:"flex flex-col justify-center",children:e.jsx("button",{onClick:P,className:"bg-red-500 text-white px-4 py-2 rounded",disabled:g,children:g?"Deleting...":"Delete Aadhar"})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Permanent Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:j})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar Number"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:b})]})]})})}),e.jsx("div",{className:"flex justify-end m-0 gap-1 ",children:e.jsx("button",{onClick:S,className:"btn btn-secondary w-full sm:w-auto",children:"Close"})})]}),p!==null&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-[60]",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg flex relative",children:[e.jsx("button",{onClick:n,className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:"✖"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>N(-1),className:"px-4 py-2 bg-gray-300 rounded",children:"⬅"}),e.jsx("img",{src:t[p],className:"max-w-[70%] max-h-[90vh] object-contain mx-4",alt:"Zoomed Aadhar"}),e.jsx("button",{onClick:()=>N(1),className:"px-4 py-2 bg-gray-300 rounded",children:"➡"})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-1/3 p-4",children:[e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Aadhar Number",value:b,onChange:c=>E(c.target.value)}),e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Permanent Address",value:j,onChange:c=>D(c.target.value)}),e.jsx("button",{onClick:r,className:"bg-blue-500 text-white px-4 py-2 rounded",disabled:g,children:g?"Saving...":"Save"})]})]})}),$&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-[60]",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg relative",children:[e.jsx("button",{onClick:()=>x(!1),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:"✖"}),e.jsx("img",{src:a.profilePic,className:"max-w-full max-h-[90vh] object-contain",alt:"Zoomed Profile"})]})})]})},O=()=>{const[a,S]=h.useState([]),[U,p]=h.useState(null),[m,$]=h.useState(""),[x,j]=h.useState(""),D=L(),b=async()=>{var s,t;try{const r=await C.get(`${k}/auth/getAllUser`);console.log(r.data,"response.data");const l=r.data.user.filter(n=>n.isAdminApproved===!0);S(l)}catch(r){console.error("Error:",r.message),i((t=(s=r==null?void 0:r.response)==null?void 0:s.data)==null?void 0:t.message)}},E=async s=>{i.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete?"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>g(s),children:"Yes"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:i.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},g=async s=>{var t,r,l;i.dismiss();try{const n=await C.delete(`${k}/auth/deleteUser`,{headers:{"Content-Type":"application/json"},data:{id:s}});n.status===200&&(i((t=n==null?void 0:n.data)==null?void 0:t.message),b())}catch(n){console.error("Error:",n.message),i((l=(r=n==null?void 0:n.response)==null?void 0:r.data)==null?void 0:l.message)}};h.useEffect(()=>{b()},[]);const y=a.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.email.toLowerCase().includes(m.toLowerCase())||s.phone.includes(m)).sort((s,t)=>x==="A-Z"?t.name.localeCompare(s.name):x==="Z-A"?s.name.localeCompare(t.name):x==="oldest-newest"?new Date(t.createdAt)-new Date(s.createdAt):x==="newest-oldest"?new Date(s.createdAt)-new Date(t.createdAt):0),f=async s=>{var t,r;if(console.log(s,"referredById"),!!s)try{const l=await C.get(`${k}/auth/getUserById/${s}`);p(l.data.user)}catch(l){console.error("Error fetching referred user:",l.message),i(((r=(t=l==null?void 0:l.response)==null?void 0:t.data)==null?void 0:r.message)||"Failed to fetch referred user details")}};return e.jsxs(e.Fragment,{children:[e.jsx(I,{}),e.jsx(z,{}),e.jsxs("div",{className:"my-32",children:[e.jsx("section",{children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"card bg-base-100 shadow-xl mt-5",children:[e.jsx("div",{className:"card-header text-xl font-bold py-3",children:"All Users"}),e.jsxs("div",{className:"p-3",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by Name, Email, or Phone",value:m,onChange:s=>$(s.target.value)}),e.jsxs("select",{className:"form-select mt-2",value:x,onChange:s=>j(s.target.value),children:[e.jsx("option",{value:"",children:"Sort By"}),e.jsx("option",{value:"A-Z",children:"A-Z"}),e.jsx("option",{value:"Z-A",children:"Z-A"}),e.jsx("option",{value:"oldest-newest",children:"Oldest-Newest"}),e.jsx("option",{value:"newest-oldest",children:"Newest-Oldest"})]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table table-bordered border",children:[e.jsx("thead",{className:"text-bold text-[15px] text-black bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{children:"SrNo"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Referred By"}),e.jsx("th",{children:"UserStatus"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Remarks"})]})}),e.jsx("tbody",{children:y.reverse().map((s,t)=>{var r,l,n,N,P,u,v;return e.jsxs("tr",{children:[e.jsx("th",{children:t+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.phone}),e.jsx("td",{children:`${(r=s==null?void 0:s.address)==null?void 0:r.area}, ${(l=s==null?void 0:s.address)==null?void 0:l.city}, ${(n=s==null?void 0:s.address)==null?void 0:n.state}, ${(N=s==null?void 0:s.address)==null?void 0:N.country}, ${(P=s==null?void 0:s.address)==null?void 0:P.pincode}`}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-light border border-gray-300 btn-sm",onClick:()=>{var w;return f((w=s==null?void 0:s.referredBy[0])==null?void 0:w._id)},children:((u=s==null?void 0:s.referredBy)==null?void 0:u.length)>0?(v=s==null?void 0:s.referredBy[0])==null?void 0:v.name:"N/A"})}),e.jsxs("td",{children:[" ",(s==null?void 0:s.userstatus)==="available"?e.jsx("span",{className:"btn btn-sm btn-success",children:"available"}):e.jsx("span",{className:"btn btn-sm btn-danger",children:"unavailable"})]}),e.jsx("td",{children:s.paymentVerified?e.jsx("button",{className:"btn btn-success btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment ",e.jsx(R,{})]})}):e.jsx("button",{className:"btn btn-danger btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment ",e.jsx(_,{size:17,className:""})]})})}),e.jsxs("td",{className:"d-flex",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>p(s),children:"Details"}),e.jsx("button",{className:"btn btn-danger btn-sm ml-2",onClick:()=>E(s._id),children:"Delete"}),e.jsx("button",{className:"btn btn-warning text-white btn-sm ml-2",onClick:()=>D("/admin/editUser",{state:s}),children:"Edit"})]}),e.jsx("td",{children:e.jsx(F,{to:"/admin/users/addremark",state:{userId:s._id},className:"btn btn-sm btn-info",children:"Add Remarks"})})]},s._id)})})]})})]})})}),U&&e.jsx(T,{user:U,onClose:()=>p(null)})]})]})};export{O as default};
