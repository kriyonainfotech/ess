import{r as h,u as _,j as e,p as F,q as R,S as T,E as O,L as M,c as w,B as i}from"./index-CDisOkul.js";const f="https://ees121.com",q=({user:t,onClose:v,onApprove:S})=>{var Z,B,I,L,z;const[g,m]=h.useState(null),[U,x]=h.useState(!1),[y,$]=h.useState(t.permanentAddress||""),[j,D]=h.useState(t.aadharNumber||""),[b,p]=h.useState(!1),[E,s]=h.useState(t.profilePic),[d,n]=h.useState(t._id),a=[t.frontAadhar,t.backAadhar];if(!t)return null;const o=async()=>{var r,c,u;console.log(y,j,d,"permanentAddress, aadharNumber");try{p(!0);const l=await w.put(`${f}/auth/updateUserAddressAndAadhar`,{permanentAddress:y,aadharNumber:j,userId:d});console.log(l.data),l.status===200&&i.success((r=l==null?void 0:l.data)==null?void 0:r.message)}catch(l){console.log("Error updating user details:",l),i.error(((u=(c=l==null?void 0:l.response)==null?void 0:c.data)==null?void 0:u.message)||"Failed to update user details")}finally{p(!1)}},A=r=>{m(r)},C=()=>{m(null)},N=r=>{m(c=>(c+r+a.length)%a.length)},k=async()=>{var r,c,u;try{p(!0);const l=await w.delete(`${f}/auth/delete-aadhar`,{data:{userId:d}});l.status===200&&(i.success((r=l==null?void 0:l.data)==null?void 0:r.message),v())}catch(l){console.error("Error deleting Aadhar:",l),i.error(((u=(c=l==null?void 0:l.response)==null?void 0:c.data)==null?void 0:u.message)||"Failed to delete Aadhar images")}finally{p(!1)}},P=async()=>{try{p(!0);const r=await fetch(`${f}/auth/update-profile-pic`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t._id,profilePic:"https://res.cloudinary.com/dcfm0aowt/image/upload/v1739604108/user/phnbhd4onynoetzdxqjp.jpg"})}),c=await r.json();console.log(c,"response of allow reset"),r.ok?(s(c.profilePic),i.success("Profile picture updated successfully!")):i.error(c.message||"Failed to update profile picture.")}catch(r){console.log("API Error:",r),i.error("Something went wrong while updating profile picture.")}finally{p(!1)}};return e.jsxs("div",{className:"modal-overlay fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50",children:[e.jsxs("div",{className:"modal-content bg-white p-2 rounded shadow-lg w-full sm:w-3/4 md:w-1/2 lg:w-1/3 max-w-4xl h-[80vh] overflow-hidden",children:[e.jsx("h2",{className:"text-xl font-bold py-3 text-center border",children:"User Details"}),e.jsx("div",{className:"modal-body overflow-y-auto",children:e.jsx("table",{className:"table-auto w-full border-collapse border border-gray-300 bg-light",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Profile Picture"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex items-center justify-between gap-2",children:[e.jsx("img",{src:E,width:50,alt:"Profile",className:"cursor-pointer",onClick:()=>x(!0)}),e.jsx("button",{onClick:P,className:"bg-blue-500 text-white px-3 py-1 rounded",disabled:b,children:b?"Updating...":"Allow Update"})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.name})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Email"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.email})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Contact"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.phone})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:`${(Z=t==null?void 0:t.address)==null?void 0:Z.area} ${(B=t==null?void 0:t.address)==null?void 0:B.city} ${(I=t==null?void 0:t.address)==null?void 0:I.state} ${(L=t==null?void 0:t.address)==null?void 0:L.country} ${(z=t==null?void 0:t.address)==null?void 0:z.pincode}`})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Name"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessName})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Category"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessCategory})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Business Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:t.businessAddress})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar"}),e.jsxs("td",{className:"border border-gray-300 px-4 py-2 flex items-center justify-between gap-2",children:[a.filter(Boolean).length>0?e.jsx("div",{className:"flex gap-2",children:a.map((r,c)=>r&&e.jsx("img",{src:r,width:50,alt:`Aadhar ${c+1}`,className:"cursor-pointer",onClick:()=>A(c)},c))}):e.jsx("span",{className:"text-red-500",children:"Photos Deleted"}),a.filter(Boolean).length>0&&e.jsx("div",{className:"flex flex-col justify-center",children:e.jsx("button",{onClick:k,className:"bg-red-500 text-white btn-sm px-4 py-1 rounded",disabled:b,children:b?"Deleting...":"Delete Aadhar"})})]})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Permanent Address"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:y})]}),e.jsxs("tr",{children:[e.jsx("td",{className:"border border-gray-300 px-4 py-2 font-semibold",children:"Aadhar Number"}),e.jsx("td",{className:"border border-gray-300 px-4 py-2",children:j})]})]})})}),e.jsx("div",{className:"flex justify-end m-0 gap-1 ",children:e.jsx("button",{onClick:v,className:"btn btn-secondary w-full sm:w-auto",children:"Close"})})]}),g!==null&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-[60]",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg flex relative",children:[e.jsx("button",{onClick:C,className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:"✖"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("button",{onClick:()=>N(-1),className:"px-4 py-2 bg-gray-300 rounded",children:"⬅"}),e.jsx("img",{src:a[g],className:"max-w-[70%] max-h-[90vh] object-contain mx-4",alt:"Zoomed Aadhar"}),e.jsx("button",{onClick:()=>N(1),className:"px-4 py-2 bg-gray-300 rounded",children:"➡"})]}),e.jsxs("div",{className:"flex flex-col gap-4 w-1/3 p-4",children:[e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Aadhar Number",value:j,onChange:r=>D(r.target.value)}),e.jsx("input",{type:"text",className:"border p-2 w-full",placeholder:"Permanent Address",value:y,onChange:r=>$(r.target.value)}),e.jsx("button",{onClick:o,className:"bg-blue-500 text-white px-4 py-2 rounded",disabled:b,children:b?"Saving...":"Save"})]})]})}),U&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-[60]",children:e.jsxs("div",{className:"bg-white p-4 rounded-lg relative",children:[e.jsx("button",{onClick:()=>x(!1),className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full",children:"✖"}),e.jsx("img",{src:t.profilePic,className:"max-w-full max-h-[90vh] object-contain",alt:"Zoomed Profile"})]})})]})},J=()=>{const[t,v]=h.useState([]),[S,g]=h.useState(null),[m,U]=h.useState(""),[x,y]=h.useState(""),$=_(),j=async()=>{var s,d;try{const n=await w.get(`${f}/auth/getAllUser`);console.log(n.data,"response.data");const a=n.data.user.filter(o=>o.isAdminApproved===!0);v(a)}catch(n){console.error("Error:",n.message),i((d=(s=n==null?void 0:n.response)==null?void 0:s.data)==null?void 0:d.message)}},D=async s=>{i.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete?"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>b(s),children:"Yes"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:i.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},b=async s=>{var d,n,a;i.dismiss();try{const o=await w.delete(`${f}/auth/deleteUser`,{headers:{"Content-Type":"application/json"},data:{id:s}});o.status===200&&(i((d=o==null?void 0:o.data)==null?void 0:d.message),j())}catch(o){console.error("Error:",o.message),i((a=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:a.message)}};h.useEffect(()=>{j()},[]);const p=t.filter(s=>s.name.toLowerCase().includes(m.toLowerCase())||s.email.toLowerCase().includes(m.toLowerCase())||s.phone.includes(m)).sort((s,d)=>x==="A-Z"?d.name.localeCompare(s.name):x==="Z-A"?s.name.localeCompare(d.name):x==="oldest-newest"?new Date(d.createdAt)-new Date(s.createdAt):x==="newest-oldest"?new Date(s.createdAt)-new Date(d.createdAt):0),E=async s=>{var d,n;if(console.log(s,"referredById"),!!s)try{const a=await w.get(`${f}/auth/getUserById/${s}`);g(a.data.user)}catch(a){console.error("Error fetching referred user:",a.message),i(((n=(d=a==null?void 0:a.response)==null?void 0:d.data)==null?void 0:n.message)||"Failed to fetch referred user details")}};return e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx(R,{}),e.jsxs("div",{className:"my-32",children:[e.jsx("section",{children:e.jsx("div",{className:"container-fluid",children:e.jsxs("div",{className:"card bg-base-100 shadow-xl mt-5",children:[e.jsx("div",{className:"card-header text-xl font-bold py-3",children:"All Users"}),e.jsxs("div",{className:"p-3",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by Name, Email, or Phone",value:m,onChange:s=>U(s.target.value)}),e.jsxs("select",{className:"form-select mt-2",value:x,onChange:s=>y(s.target.value),children:[e.jsx("option",{value:"",children:"Sort By"}),e.jsx("option",{value:"A-Z",children:"A-Z"}),e.jsx("option",{value:"Z-A",children:"Z-A"}),e.jsx("option",{value:"oldest-newest",children:"Oldest-Newest"}),e.jsx("option",{value:"newest-oldest",children:"Newest-Oldest"})]})]}),e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"table table-bordered border",children:[e.jsx("thead",{className:"text-bold text-[15px] text-black bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{children:"SrNo"}),e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Contact"}),e.jsx("th",{children:"Address"}),e.jsx("th",{children:"Referred By"}),e.jsx("th",{children:"UserStatus"}),e.jsx("th",{children:"Payment Status"}),e.jsx("th",{children:"Action"}),e.jsx("th",{children:"Remarks"})]})}),e.jsx("tbody",{children:p.reverse().map((s,d)=>{var n,a,o,A,C,N,k;return e.jsxs("tr",{children:[e.jsx("th",{children:d+1}),e.jsx("td",{children:s.name}),e.jsx("td",{children:s.email}),e.jsx("td",{children:s.phone}),e.jsx("td",{children:`${(n=s==null?void 0:s.address)==null?void 0:n.area}, ${(a=s==null?void 0:s.address)==null?void 0:a.city}, ${(o=s==null?void 0:s.address)==null?void 0:o.state}, ${(A=s==null?void 0:s.address)==null?void 0:A.country}, ${(C=s==null?void 0:s.address)==null?void 0:C.pincode}`}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-light border border-gray-300 btn-sm",onClick:()=>{var P;return E((P=s==null?void 0:s.referredBy[0])==null?void 0:P._id)},children:((N=s==null?void 0:s.referredBy)==null?void 0:N.length)>0?(k=s==null?void 0:s.referredBy[0])==null?void 0:k.name:"N/A"})}),e.jsxs("td",{children:[" ",(s==null?void 0:s.userstatus)==="available"?e.jsx("span",{className:"btn btn-sm btn-success",children:"available"}):e.jsx("span",{className:"btn btn-sm btn-danger",children:"unavailable"})]}),e.jsx("td",{children:s.paymentVerified?e.jsx("button",{className:"btn btn-success btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment ",e.jsx(T,{})]})}):e.jsx("button",{className:"btn btn-danger btn-sm",children:e.jsxs("span",{className:"text-white flex items-center gap-2",children:["Payment ",e.jsx(O,{size:17,className:""})]})})}),e.jsxs("td",{className:"d-flex",children:[e.jsx("button",{className:"btn btn-primary btn-sm",onClick:()=>g(s),children:"Details"}),e.jsx("button",{className:"btn btn-danger btn-sm ml-2",onClick:()=>D(s._id),children:"Delete"}),e.jsx("button",{className:"btn btn-warning text-white btn-sm ml-2",onClick:()=>$("/admin/editUser",{state:s}),children:"Edit"})]}),e.jsx("td",{children:e.jsx(M,{to:"/admin/users/addremark",state:{userId:s._id},className:"btn btn-sm btn-info",children:"Add Remarks"})})]},s._id)})})]})})]})})}),S&&e.jsx(q,{user:S,onClose:()=>g(null)})]})]})};export{J as default};
