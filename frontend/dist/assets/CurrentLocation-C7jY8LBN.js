import{r as c,j as t,s as S,B as r,c as v}from"./index-DIxwlOJk.js";const k="https://ess-eta.vercel.app",L=({user:e})=>{var h,m,x,y,g;const[a,j]=c.useState({}),[n,d]=c.useState(!1),[w,f]=c.useState(!1),[P,b]=c.useState(""),[E,l]=c.useState(""),N=async i=>{try{const u=await(await fetch(`https://api.postalpincode.in/pincode/${i}`)).json();if(u[0].Status==="Success"){const s=u[0].PostOffice[0];console.log(s,"location poste"),s?j({area:s.Name||"",city:s.District||"",state:s.State||"",country:s.Country||"",pincode:s.Pincode||""}):r.error("Unable to fetch location details. Please try again."),l("")}else l("Invalid Pincode! Please enter a valid one.")}catch{l("Failed to fetch location details. Try again later.")}},C=i=>{const o=i.target.value.trim();b(o),o.length===6&&N(o)},p=async()=>{if(!a.area&&!a.city&&!a.state&&!a.country&&!a.pincode){r.error("Please fetch your current location first!");return}f(!0);const i=JSON.parse(localStorage.getItem("token"));try{(await v.post(`${k}/auth/updateProfile`,{address:a},{headers:{Authorization:`Bearer ${i}`},withCredentials:!0})).status===200?(d(!1),window.location.reload()):r.error("Failed to update location")}catch(o){console.error("Error updating profile:",o),r.error("Failed to update profile. Please try again.")}finally{f(!1)}};return t.jsxs("div",{children:[t.jsxs("div",{className:"d-flex  gap-2",children:[t.jsxs("p",{className:"text-gray mb-0",children:[(h=e==null?void 0:e.address)==null?void 0:h.area," ",(m=e==null?void 0:e.address)==null?void 0:m.city," ",(x=e==null?void 0:e.address)==null?void 0:x.state," ",(y=e==null?void 0:e.address)==null?void 0:y.country," ",(g=e==null?void 0:e.address)==null?void 0:g.pincode]}),t.jsx(S,{className:"md:text-md cursor-pointer d-none d-md-flex  ",onClick:()=>{n&&p(),d(!n)}})]}),t.jsx("div",{className:"border p-1 rounded-1 d-md-none",onClick:()=>{n&&p(),d(!n)},children:"Current Location"}),n&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"",children:[t.jsx("label",{className:"block text-sm font-medium",children:"Pincode"}),t.jsx("input",{type:"text",value:P,onChange:C,className:"mt-1 block w-full border border-gray-300 rounded-md p-2"})]}),t.jsxs("p",{className:"bg-white",children:[a.area," ",a.city," ",a.state," ",a.country," ",a.pincode,t.jsx("button",{onClick:p,className:"btn border ms-2",children:"Update"})]})]})]})};export{L as C};
