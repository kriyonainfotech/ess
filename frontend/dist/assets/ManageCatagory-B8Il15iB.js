import{r as l,j as e,c as v,n as F,o as P,B as h}from"./index-C-JRaRFD.js";const k="https://ees121.com",A=({editcategory:o,fetchCategory:u})=>{const[m,g]=l.useState(""),[y,x]=l.useState(""),[p,b]=l.useState(""),[j,f]=l.useState(!1),[N,d]=l.useState(""),w=n=>{const r=n.target.files[0];if(console.log(r,"filea"),r&&r.type.startsWith("image/")){x(r);const a=URL.createObjectURL(r);b(a),console.log("New image preview URL:",a)}else alert("Please select a valid image file.")},S=async n=>{var a,t;if(n.preventDefault(),!m){alert("Please fill all fields");return}const r=new FormData;r.append("categoryName",m),y&&r.append("category",y),r.append("categorId",o._id);try{f(!0);const s=await v.post(`${k}/category/updateCategory`,r,{headers:{"Content-Type":"multipart/form-data"}});if(s.data.success){alert("Category edited successfully!"),u(),g(""),x(""),b(""),d("");const c=document.querySelector("[data-bs-dismiss='modal']");c&&c.click()}else d(s.data.message||"Failed to update category. Please try again.")}catch(s){console.error("Error updating category:",s),d(((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)||"Failed to update category. Please try again.")}finally{f(!1)}};return l.useEffect(()=>{o&&(g(o.categoryName),b(o.image))},[o]),e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",children:"Edit Category"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:S,encType:"multipart/form-data",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category-name",className:"col-form-label",children:"Category Name:"}),e.jsx("input",{type:"text",className:"form-control",value:m,onChange:n=>g(n.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"file-upload",className:"col-form-label",children:"Category Image:"}),e.jsx("label",{htmlFor:"file-upload",className:"btn d-inline-block border border-orange d-flex justify-content-start align-items-center",children:"Category Image"}),e.jsx("input",{type:"file",id:"file-upload",name:"categoryImg",onChange:w}),p&&e.jsx("img",{src:p,alt:"Preview",width:"100"})]}),N&&e.jsx("div",{className:"alert alert-danger",children:N}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:j,children:j?"Updating...":"Update Category"})})]})})]})},I="https://ees121.com",L=()=>{const[o,u]=l.useState(""),[m,g]=l.useState(null),[y,x]=l.useState(null),[p,b]=l.useState([]),[j,f]=l.useState([]);l.useState(!1);const N=async a=>{var s,c,C;if(a.preventDefault(),!o||!m){alert("Please fill all fields");return}const t=new FormData;t.append("categoryName",o),t.append("category",m);try{const i=await v.post(`${I}/category/addCategory`,t,{headers:{"Content-Type":"multipart/form-data"}});h((s=i==null?void 0:i.data)==null?void 0:s.message),d();const E=document.querySelector("[data-bs-dismiss='modal']");E&&E.click(),u(""),g(null),x(null)}catch(i){h((C=(c=i==null?void 0:i.response)==null?void 0:c.data)==null?void 0:C.message)}},d=async()=>{var a,t;try{const s=await v.get(`${I}/category/getAllCategory`);b(s.data.category.sort((c,C)=>c.categoryName.localeCompare(C.categoryName)))}catch(s){console.error("Error fetching categories:",s),h((t=(a=s==null?void 0:s.response)==null?void 0:a.data)==null?void 0:t.message)}};l.useEffect(()=>{d()},[]);const w=async a=>{h.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to delete this request?"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>S(a),children:"Yes"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:h.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},S=async a=>{h.dismiss();try{(await v.delete(`${I}/category/deleteCategory`,{headers:{"Content-Type":"application/json"},data:{categoryId:a}})).status===200?(alert("Category deleted successfully."),d()):alert("Failed to delete category. Please try again.")}catch(t){console.error("Error deleting category:",t),alert("Failed to delete category. Check console for more details.")}},n=a=>{f(a)},r=a=>{const t=a.target.files[0];t&&t.type.startsWith("image/")?(g(t),x(URL.createObjectURL(t))):alert("Please select a valid image file.")};return e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx(P,{}),e.jsx("section",{className:"mt-32",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-md-12",children:e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"card-header d-flex justify-content-between align-items-center",children:[e.jsx("h4",{children:"Manage Category"}),e.jsx("button",{className:"btn bg-blue text-white","data-bs-toggle":"modal","data-bs-target":"#exampleModalE",children:"Add Category"})]}),e.jsx("div",{className:"modal fade",id:"exampleModalE",tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",id:"exampleModalLabel",children:"Add Category"}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body",children:e.jsxs("form",{onSubmit:N,encType:"multipart/form-data",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category-name",className:"col-form-label",children:"Category Name:"}),e.jsx("input",{type:"text",className:"form-control",placeholder:"Category Name",value:o,onChange:a=>u(a.target.value)})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category-img",className:"col-form-label",children:"Category Image:"}),e.jsx("label",{htmlFor:"file-upload",className:"btn d-inline-block border border-orange d-flex justify-content-start align-items-center",children:"Category Image"}),e.jsx("input",{type:"file",id:"file-upload",name:"categoryImg",onChange:r}),y&&e.jsx("img",{src:y,alt:"Preview",width:"100"})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Add"})]})]})})]})})}),e.jsx("div",{className:"card-body overflow-x-auto",children:e.jsxs("table",{className:"table text-capitalize table-bordered",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Sr No"}),e.jsx("th",{children:"Category Name"}),e.jsx("th",{children:"Category Image"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:p.map((a,t)=>e.jsxs("tr",{className:"text-capitalize",children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:a.categoryName}),e.jsx("td",{children:e.jsx("img",{src:a.image,alt:"Category",width:70})}),e.jsxs("td",{className:"d-flex gap-2 justify-content-center",children:[e.jsx("button",{className:"btn bg-green text-white",onClick:()=>n(a),"data-bs-toggle":"modal","data-bs-target":"#exampleModal",children:"Edit"}),e.jsx("button",{className:"btn bg-orange text-white ms-2",onClick:()=>w(a._id),children:"Delete"})]})]},a._id))})]})}),e.jsx("div",{className:"modal fade",id:"exampleModal",tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsx(A,{editcategory:j,fetchCategory:d})})})]})})})})})]})};export{L as default};
