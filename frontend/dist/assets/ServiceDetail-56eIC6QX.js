import{r as s,F,U as I,u as L,j as e,P as A,L as P,c as E,B as y,i as B,A as z,e as M,f as _,h as k}from"./index-DIxwlOJk.js";import{s as O,a as D}from"./startSilver-5oWuoMuE.js";import{$ as T}from"./module-CfKkWrpG.js";const q="https://ess-eta.vercel.app",J=({Usersdata:t,token:g})=>{var S,j,c,x,a;s.useContext(F),s.useContext(I);const[u,v]=s.useState(null),[h,r]=s.useState(!1),[R,N]=s.useState([]),[p,i]=s.useState("I NEED YOUR SERVICE"),w=L(),C=(o=[],d=5)=>{const m=o.length>0?o.reduce((l,b)=>l+b,0)/o.length:0,n=[];for(let l=1;l<=d;l++)n.push(e.jsx("img",{src:l<=m?O:D,alt:l<=m?"Filled Star":"Empty Star",width:15},l));return n};s.useEffect(()=>{(async()=>{var d,m,n;r(!0);try{const l=await E.get(`${q}/request/getUserRequests`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`}});if(l.status===200){N(l.data);const b=l.data.sendedRequests.find($=>$.user._id===(t==null?void 0:t._id));v((b==null?void 0:b.status)||null)}}catch(l){console.error("Error fetching requests:",((d=l.response)==null?void 0:d.data)||l.message),y((n=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:n.message)}finally{r(!1)}})()},[t,g]);const f=async(o,d="I NEED YOUR SERVICE")=>{var m;if((t==null?void 0:t.userstatus)==="unavailable"){y("User is unavailable");return}r(!0);try{const n=await E.post(`${q}/request/sentRequest`,{receiverId:o,message:d},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`}});n.status===200?(v("pending"),y(n.data.message||"Request Sent Successfully!"),w("/work")):y.error(n.data.message)}catch(n){console.error("Error sending request:",((m=n.response)==null?void 0:m.data)||n.message),y.error(n.response.data.message)}finally{r(!1)}};return t?e.jsx(e.Fragment,{children:e.jsx("div",{className:"col-12 col-md-6 col-xl-3 p-2",style:{cursor:"pointer"},children:e.jsxs("div",{className:"d-flex flex-md-column border-0 overflow-hidden rounded-3 shadow-xl",style:{position:"relative"},children:[e.jsxs("div",{className:"col-5 col-md-7 p-2",children:[e.jsx("div",{className:"d-flex w-100 h-[150px] justify-content-center border rounded-2 align-items-center",children:e.jsx("img",{src:(t==null?void 0:t.profilePic)||A,alt:"User Profile",className:"img-fluid overflow-hidden w-100 h-100",style:{objectFit:"cover",objectPosition:"center"}})}),e.jsx("div",{style:{position:"absolute",top:"2%",right:"3%"},children:e.jsx("span",{className:`px-2 py-1 shadow-xl bg-white d-flex align-items-center rounded-5 text-capitalize text-sm ${(t==null?void 0:t.userstatus)==="available"?"text-green":"text-orange"}`,children:t==null?void 0:t.userstatus})})]}),e.jsx("div",{className:"col-8 col-md-12",children:e.jsxs("div",{className:"p-3 w-100 text-capitalize",children:[e.jsx("h4",{className:"font-bold",children:t==null?void 0:t.name}),e.jsx("h6",{className:"font-semibold py-1",children:t==null?void 0:t.businessCategory}),e.jsxs("p",{className:"text-muted text",children:[(S=t==null?void 0:t.address)==null?void 0:S.area," ",(j=t==null?void 0:t.address)==null?void 0:j.city," ",(c=t==null?void 0:t.address)==null?void 0:c.state," ",(x=t==null?void 0:t.address)==null?void 0:x.country," ",(a=t==null?void 0:t.address)==null?void 0:a.pincode]}),e.jsx("div",{className:"py-2",children:t.ratings?e.jsxs("div",{className:"d-flex align-items-center",children:[C(t.ratings.map(o=>o.rating),10),e.jsx("span",{className:"ps-2",children:t.ratings.length>0&&t.ratings.reduce((o,d)=>o+d.rating,0)/t.ratings.length})]}):e.jsx(e.Fragment,{})}),e.jsx("div",{children:u==="pending"?e.jsx(P,{to:`tel:${t.phone}`,className:"btn bg-green rounded-1 text-semibold text-white",children:"Contact Now"}):e.jsx("button",{className:"p-2 rounded-2 text-sm bg-green text-white","data-bs-toggle":"modal","data-bs-target":`#modal-${t._id}`,disabled:h,children:h?e.jsx("div",{className:"spinner-border text-white",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}):"Send now"})})]})}),e.jsx("div",{children:e.jsx("div",{className:"modal fade",id:`modal-${t._id}`,tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content shadow-lg rounded-lg",children:[e.jsxs("div",{className:"modal-header border-bottom-0",children:[e.jsxs("h5",{className:"modal-title text-xl font-semibold",id:"exampleModalLabel",children:["Send Request to ",t.name]}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body pb-4 pt-0",children:[e.jsx("h4",{className:"text-lg text-start capitalize font-medium mb-2",children:t.businessCategory}),e.jsx("div",{className:"card bg-white shadow-md ",children:e.jsx("textarea",{className:"form-control resize-none",value:p,onChange:o=>i(o.target.value),rows:"4",placeholder:"Write your message..."})})]}),e.jsxs("div",{className:"modal-footer border-top-0 pt-3",children:[e.jsx("button",{type:"button",className:"btn btn-secondary w-32","data-bs-dismiss":"modal",children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>f(t._id),"data-bs-dismiss":"modal",disabled:h,children:h?e.jsx("div",{className:"spinner-border spinner-border-sm text-white",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}):"Send Request"})]})]})})})})]})})}):e.jsx("p",{children:"Loading user data..."})},V="https://ess-eta.vercel.app",H=()=>{var j;const{user:t}=s.useContext(I),g=s.useMemo(()=>JSON.parse(localStorage.getItem("token")),[]),u=B(),[v,h]=s.useState(!1),[r,R]=s.useState(()=>localStorage.getItem("selectedCategory")||null),[N,p]=s.useState([]),[i,w]=s.useState(()=>t||JSON.parse(localStorage.getItem("loggedInUser"))||null),[C,f]=s.useState(""),S=async(c,x)=>{h(!0);try{const a=await E.post(`${V}/auth/getUsersByBCategory`,{category:c,city:x,status:"available",isAdminApproved:!0,sortByRating:"desc"},{headers:{"Content-Type":"application/json"},withCredentials:!0});console.log(a,"categoies"),a.data.success?(p(a.data.users),f(a.data.message)):(console.error("Error fetching data:",a.data.message),p([]),f(a.data.message))}catch(a){console.error("Error fetching data:",a.message||a),p([]),f("Failed to fetch providers. Please try again.")}finally{h(!1)}};return s.useEffect(()=>{window.scrollTo(0,0)},[]),s.useEffect(()=>{u.state&&(R(u.state),localStorage.setItem("selectedCategory",u.state))},[u.state]),s.useEffect(()=>{var c;r&&((c=i==null?void 0:i.address)!=null&&c.city)&&S(r,i.address.city)},[r,(j=i==null?void 0:i.address)==null?void 0:j.city]),s.useEffect(()=>{t&&(w(t),localStorage.setItem("loggedInUser",JSON.stringify(t)))},[t]),e.jsxs(e.Fragment,{children:[e.jsx(z,{}),e.jsx(M,{}),e.jsx(_,{}),e.jsx("section",{className:"mt-40",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"d-flex",children:e.jsx("h3",{className:"pt-4 px-3 text-capitalize",children:u.state})}),e.jsx("div",{className:"col-12 d-flex flex-wrap",children:v?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",width:"100vw"},children:e.jsx(T,{color:"#00BFFF",height:50,width:50})}):N.length>0?N.map((c,x)=>e.jsx(J,{Usersdata:c,token:g},x)):e.jsx("h6",{className:"pt-3 px-3",children:C})})]})})}),e.jsx(k,{})]})};export{H as default};
