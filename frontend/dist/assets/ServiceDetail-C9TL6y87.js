import{r as s,F as P,U as $,u as k,j as t,k as B,L as z,c as E,B as v,i as M,A as O,d as T,P as V,t as D,h as J}from"./index-CDisOkul.js";import{s as Y,a as G}from"./startSilver-5oWuoMuE.js";const _="https://ees121.com",W=({Usersdata:e,token:h})=>{var q,y,o,g,r;console.log(e,"Usersdata"),s.useContext(P),s.useContext($);const[p,N]=s.useState(null),[f,a]=s.useState(!1),[A,w]=s.useState([]),[x,c]=s.useState("I NEED YOUR SERVICE"),S=k(),R=(i=[],d=10)=>{const u=i.length>0?i.reduce((l,n)=>l+n,0)/i.length:0;return Array.from({length:d},(l,n)=>t.jsx("img",{src:n<u?Y:G,alt:n<u?"Filled Star":"Empty Star",width:15},n))};s.useEffect(()=>{(async()=>{var d,u,l;a(!0);try{const n=await E.get(`${_}/request/getUserRequests`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}});if(console.log(n.data.requests),n.status===200&&n.data.requests){w(n.data.requests);const F=n.data.requests.sended_requests||[],L=n.data.requests.received_requests||[],I=F.filter(m=>{var b;return((b=m.user)==null?void 0:b._id)===(e==null?void 0:e._id)}),K=L.find(m=>{var b;return((b=m.user)==null?void 0:b._id)===(e==null?void 0:e._id)});let C=null;I.some(m=>m.status==="pending")?C="pending":I.some(m=>m.status==="completed"||m.status==="rated")&&(C="completed"),N(C),console.log("Updated Request Status:",C)}}catch(n){console.error("Error fetching requests:",((d=n.response)==null?void 0:d.data)||n.message),v((l=(u=n==null?void 0:n.response)==null?void 0:u.data)==null?void 0:l.message)}finally{a(!1)}})()},[e,h]);const j=async(i,d="I NEED YOUR SERVICE")=>{var u;if((e==null?void 0:e.userstatus)==="unavailable"){v("User is unavailable");return}a(!0);try{const l=await E.post(`${_}/request/sentRequest`,{receiverId:e._id,message:d},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${h}`}});l.status===200?(N("pending"),v(l.data.message||"Request Sent Successfully!"),S("/work"),setTimeout(()=>{window.location.reload()},500)):v.error(l.data.message)}catch(l){console.error("Error sending request:",((u=l.response)==null?void 0:u.data)||l.message),v.error(l.response.data.message)}finally{a(!1)}};return e?t.jsx(t.Fragment,{children:t.jsxs("div",{className:"col-12 col-md-6 col-xl-4 p-2 cursor-pointer",children:[t.jsxs("div",{className:"flex flex-col border overflow-hidden rounded-lg shadow-lg relative bg-white w-full h-full",children:[t.jsxs("div",{className:"relative p-2",children:[t.jsx("div",{className:"flex justify-center items-center w-full h-70 border rounded-md overflow-hidden bg-gray-100",children:t.jsx("img",{src:(e==null?void 0:e.profilePic)||B,alt:"User Profile",className:"w-full h-full object-cover object-center"})}),t.jsx("div",{className:"absolute top-3 right-3",children:t.jsx("span",{className:`px-3 py-1 shadow-md rounded-full text-xs font-medium 
          ${(e==null?void 0:e.userstatus)==="available"?"bg-green-600 text-white":"bg-red-600 text-white"}`,children:e==null?void 0:e.userstatus})})]}),t.jsxs("div",{className:"p-4 text-start",children:[t.jsxs("div",{className:"flex justify-between items-center pb-3",children:[t.jsx("h4",{className:"font-bold text-lg capitalize",children:e==null?void 0:e.name}),t.jsx("h6",{className:"font-medium text-gray-700 py-1 capitalize",children:e==null?void 0:e.businessCategory.join(", ")})]}),t.jsxs("p",{className:"text-gray-500 text-sm",children:[`${(q=e==null?void 0:e.address)==null?void 0:q.area}, ${(y=e==null?void 0:e.address)==null?void 0:y.city}, ${(o=e==null?void 0:e.address)==null?void 0:o.state}, ${(g=e==null?void 0:e.address)==null?void 0:g.country}`," ",t.jsx("br",{}),`${(r=e==null?void 0:e.address)==null?void 0:r.pincode}`]}),t.jsxs("div",{className:"py-2 flex justify-start items-center",children:[t.jsxs("p",{className:"text-xs font-medium flex justify-center items-center",children:["User : ",t.jsx("span",{className:"flex ",children:R(e.userRatings.map(i=>i.rating),10)})]}),t.jsxs("span",{className:"ml-2 text-sm font-medium",children:[" ",e.userAverageRating>0?e.userAverageRating.toFixed(1):"0.0"]})]}),t.jsxs("div",{className:"py-2 flex justify-start items-center",children:[t.jsxs("p",{className:"text-xs font-medium flex justify-center items-center",children:["Provider :",t.jsx("span",{className:"flex ",children:R(e.providerRatings.map(i=>i.rating),10)})]}),t.jsxs("span",{className:"ml-2 text-sm font-medium",children:[" ",e.providerAverageRating>0?e.providerAverageRating.toFixed(1):"0.0"]})]}),t.jsx("div",{className:"mt-3",children:p==="pending"?t.jsxs(t.Fragment,{children:[t.jsx(z,{to:`tel:${e.phone}`,className:"bg-green-600 text-white font-semibold px-4 py-2 rounded-md shadow-md hover:bg-green-700",children:"Contact Now"}),t.jsx("button",{className:"bg-warning text-white w-100 font-semibold px-4 py-2 rounded-md shadow-md hover:bg-orange-700 transition duration-200",onClick:()=>S("/work"),children:"View Request"})]}):t.jsx("button",{className:"bg-blue-600 text-white font-semibold px-4 py-2 w-100 rounded-md shadow-md hover:bg-blue-700 transition duration-200","data-bs-toggle":"modal","data-bs-target":`#modal-${e._id}`,children:"Send Request"})})]})]}),t.jsx("div",{className:"modal fade",id:`modal-${e._id}`,tabIndex:-1,"aria-hidden":"true",children:t.jsx("div",{className:"modal-dialog modal-dialog-centered",children:t.jsxs("div",{className:"modal-content rounded-lg shadow-lg",children:[t.jsxs("div",{className:"modal-header border-b",children:[t.jsxs("h5",{className:"text-xl font-semibold",children:["Send Request to ",e.name]}),t.jsx("button",{type:"button",className:"btn-close text-white p-3","data-bs-dismiss":"modal"})]}),t.jsxs("div",{className:"modal-body py-4",children:[t.jsx("h4",{className:"text-lg capitalize font-medium mb-2",children:e.businessCategory.join(", ")}),t.jsx("textarea",{className:"w-full p-3 border rounded-md focus:outline-none focus:ring focus:ring-blue-300 resize-none",rows:"1",value:x,onChange:i=>c(i.target.value),placeholder:"Write your message..."})]}),t.jsxs("div",{className:"modal-footer border-t pt-3 flex justify-end",children:[t.jsx("button",{type:"button",className:"bg-gray-500 text-white px-4 py-2 rounded-md","data-bs-dismiss":"modal",children:"Close"}),t.jsx("button",{type:"button",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition duration-200 ml-2",onClick:()=>j(e._id),disabled:f,children:f?t.jsx("span",{className:"spinner-border spinner-border-sm text-white"}):"Send Request"})]})]})})})]})}):t.jsx("p",{children:"Loading user data..."})},H="https://ees121.com",Z=()=>{var y;const{user:e}=s.useContext($),h=s.useMemo(()=>JSON.parse(localStorage.getItem("token")),[]),p=M(),[N,f]=s.useState(!1),[a,A]=s.useState(()=>localStorage.getItem("selectedCategory")||null),[w,x]=s.useState([]),[c,S]=s.useState(()=>e||JSON.parse(localStorage.getItem("loggedInUser"))||null),[R,j]=s.useState(""),q=async(o,g)=>{if(!(!o||!g)){f(!0);try{const r=await E.post(`${H}/auth/getUsersByBCategory`,{category:o,city:g,isAdminApproved:!0,paymentVerified:!0,sortByRating:"desc"},{headers:{"Content-Type":"application/json"},withCredentials:!0});if(console.log(r.data,"response"),r.data.success){const i=Array.from(new Map(r.data.users.map(d=>[d._id,d])).values());x(i),j(r.data.message)}else console.error("Error fetching data:",r.data.message),x([]),j(r.data.message)}catch(r){console.error("Error fetching data:",r.message||r),x([]),j("Failed to fetch providers. Please try again.")}finally{f(!1)}}};return s.useEffect(()=>{window.scrollTo(0,0)},[]),s.useEffect(()=>{if(p.state){const o=p.state;A(o),localStorage.setItem("selectedCategory",o)}},[p.state]),s.useEffect(()=>{var o;a&&((o=c==null?void 0:c.address)!=null&&o.city)&&q(a,c.address.city)},[a,(y=c==null?void 0:c.address)==null?void 0:y.city]),s.useEffect(()=>()=>{x([])},[]),s.useEffect(()=>{e&&(S(e),localStorage.setItem("loggedInUser",JSON.stringify(e)))},[e]),t.jsxs(t.Fragment,{children:[t.jsx(O,{}),t.jsx(T,{}),t.jsx(V,{}),t.jsx("section",{className:" mt-28",children:t.jsx("div",{className:"container",children:t.jsxs("div",{className:"row",children:[t.jsx("div",{className:"d-flex",children:t.jsx("h3",{className:"py-4 text-capitalize",children:a})}),t.jsx("div",{className:"col-12 d-flex flex-wrap px-0",children:N?t.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",width:"100vw"},children:t.jsx(D,{color:"#00BFFF",height:50,width:50})}):w.length>0?w.map((o,g)=>t.jsx(W,{Usersdata:o,token:h},o._id)):t.jsx("h6",{className:"pt-3 px-3",children:R})})]})})}),t.jsx(J,{})]})};export{Z as default};
