import{r as s,F,U as I,u as L,j as e,P as A,L as P,c as E,B as y,m as _,A as B,e as M,f as z,k}from"./index-ud0UZF0x.js";import{s as O,a as D}from"./startSilver-5oWuoMuE.js";import{$ as T}from"./module-Cv1pUXI2.js";const q="http://localhost:3000",J=({Usersdata:t,token:g})=>{var S,j,n,x,a;s.useContext(F),s.useContext(I);const[p,v]=s.useState(null),[u,r]=s.useState(!1),[R,N]=s.useState([]),[h,d]=s.useState("I NEED YOUR SERVICE"),w=L(),C=(o=[],c=5)=>{const m=o.length>0?o.reduce((l,b)=>l+b,0)/o.length:0,i=[];for(let l=1;l<=c;l++)i.push(e.jsx("img",{src:l<=m?O:D,alt:l<=m?"Filled Star":"Empty Star",width:15},l));return i};s.useEffect(()=>{(async()=>{var c,m,i;r(!0);try{const l=await E.get(`${q}/request/getUserRequests`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`}});if(l.status===200){N(l.data);const b=l.data.sendedRequests.find($=>$.user._id===(t==null?void 0:t._id));v((b==null?void 0:b.status)||null)}}catch(l){console.error("Error fetching requests:",((c=l.response)==null?void 0:c.data)||l.message),y((i=(m=l==null?void 0:l.response)==null?void 0:m.data)==null?void 0:i.message)}finally{r(!1)}})()},[t,g]);const f=async(o,c="I NEED YOUR SERVICE")=>{var m;if((t==null?void 0:t.userstatus)==="unavailable"){y("User is unavailable");return}r(!0);try{const i=await E.post(`${q}/request/sentRequest`,{receiverId:o,message:c},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`}});i.status===200?(v("pending"),y(i.data.message||"Request Sent Successfully!"),w("/work")):y.error(i.data.message)}catch(i){console.error("Error sending request:",((m=i.response)==null?void 0:m.data)||i.message),y.error(i.response.data.message)}finally{r(!1)}};return t?e.jsx(e.Fragment,{children:e.jsx("div",{className:"col-12 col-md-6 col-xl-3 p-2",style:{cursor:"pointer"},children:e.jsxs("div",{className:"d-flex flex-md-column border-0 overflow-hidden rounded-3 shadow-xl",style:{position:"relative"},children:[e.jsxs("div",{className:"col-5 col-md-7 p-2",children:[e.jsx("div",{className:"d-flex w-100 h-[150px] justify-content-center border rounded-2 align-items-center",children:e.jsx("img",{src:(t==null?void 0:t.profilePic)||A,alt:"User Profile",className:"img-fluid overflow-hidden w-100 h-100",style:{objectFit:"cover",objectPosition:"center"}})}),e.jsx("div",{style:{position:"absolute",top:"2%",right:"3%"},children:e.jsx("span",{className:`px-2 py-1 shadow-xl bg-white d-flex align-items-center rounded-5 text-capitalize text-sm ${(t==null?void 0:t.userstatus)==="available"?"text-green":"text-orange"}`,children:t==null?void 0:t.userstatus})})]}),e.jsx("div",{className:"col-8 col-md-12",children:e.jsxs("div",{className:"p-3 w-100 text-capitalize",children:[e.jsx("h4",{className:"font-bold",children:t==null?void 0:t.name}),e.jsx("h6",{className:"font-semibold py-1",children:t==null?void 0:t.businessCategory}),e.jsxs("p",{className:"text-muted text",children:[(S=t==null?void 0:t.address)==null?void 0:S.area," ",(j=t==null?void 0:t.address)==null?void 0:j.city," ",(n=t==null?void 0:t.address)==null?void 0:n.state," ",(x=t==null?void 0:t.address)==null?void 0:x.country," ",(a=t==null?void 0:t.address)==null?void 0:a.pincode]}),e.jsx("div",{className:"py-2",children:t.ratings?e.jsxs("div",{className:"d-flex align-items-center",children:[C(t.ratings.map(o=>o.rating),10),e.jsx("span",{className:"ps-2",children:t.ratings.length>0&&t.ratings.reduce((o,c)=>o+c.rating,0)/t.ratings.length})]}):e.jsx(e.Fragment,{})}),e.jsx("div",{children:p==="pending"?e.jsx(P,{to:`tel:${t.phone}`,className:"btn bg-green rounded-1 text-semibold text-white",children:"Contact Now"}):e.jsx("button",{className:"p-2 rounded-2 text-sm bg-green text-white","data-bs-toggle":"modal","data-bs-target":`#modal-${t._id}`,disabled:u,children:u?e.jsx("div",{className:"spinner-border text-white",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})}):"Send now"})})]})}),e.jsx("div",{children:e.jsx("div",{className:"modal fade",id:`modal-${t._id}`,tabIndex:-1,"aria-labelledby":"exampleModalLabel","aria-hidden":"true",children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content shadow-lg rounded-lg",children:[e.jsxs("div",{className:"modal-header border-bottom-0",children:[e.jsxs("h5",{className:"modal-title text-xl font-semibold",id:"exampleModalLabel",children:["Send Request to ",t.name]}),e.jsx("button",{type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body pb-4 pt-0",children:[e.jsx("h4",{className:"text-lg text-start capitalize font-medium mb-2",children:t.businessCategory}),e.jsx("div",{className:"card bg-white shadow-md ",children:e.jsx("textarea",{className:"form-control resize-none",value:h,onChange:o=>d(o.target.value),rows:"4",placeholder:"Write your message..."})})]}),e.jsxs("div",{className:"modal-footer border-top-0 pt-3",children:[e.jsx("button",{type:"button",className:"btn btn-secondary w-32","data-bs-dismiss":"modal",children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>f(t._id),"data-bs-dismiss":"modal",disabled:u,children:u?e.jsx("div",{className:"spinner-border spinner-border-sm text-white",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}):"Send Request"})]})]})})})})]})})}):e.jsx("p",{children:"Loading user data..."})},V="http://localhost:3000",H=()=>{var j;const{user:t}=s.useContext(I),g=s.useMemo(()=>JSON.parse(localStorage.getItem("token")),[]),p=_(),[v,u]=s.useState(!1),[r,R]=s.useState(()=>localStorage.getItem("selectedCategory")||null),[N,h]=s.useState([]),[d,w]=s.useState(()=>t||JSON.parse(localStorage.getItem("loggedInUser"))||null),[C,f]=s.useState(""),S=async(n,x)=>{if(!(!n||!x)){u(!0);try{const a=await E.post(`${V}/auth/getUsersByBCategory`,{category:n,city:x,status:"available",isAdminApproved:!0,sortByRating:"desc"},{headers:{"Content-Type":"application/json"},withCredentials:!0});if(a.data.success){const o=Array.from(new Map(a.data.users.map(c=>[c._id,c])).values());h(o),f(a.data.message)}else console.error("Error fetching data:",a.data.message),h([]),f(a.data.message)}catch(a){console.error("Error fetching data:",a.message||a),h([]),f("Failed to fetch providers. Please try again.")}finally{u(!1)}}};return s.useEffect(()=>{window.scrollTo(0,0)},[]),s.useEffect(()=>{if(p.state){const n=p.state;R(n),localStorage.setItem("selectedCategory",n)}},[p.state]),s.useEffect(()=>{var n;r&&((n=d==null?void 0:d.address)!=null&&n.city)&&S(r,d.address.city)},[r,(j=d==null?void 0:d.address)==null?void 0:j.city]),s.useEffect(()=>()=>{h([])},[]),s.useEffect(()=>{t&&(w(t),localStorage.setItem("loggedInUser",JSON.stringify(t)))},[t]),e.jsxs(e.Fragment,{children:[e.jsx(B,{}),e.jsx(M,{}),e.jsx(z,{}),e.jsx("section",{className:"mt-40",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"d-flex",children:e.jsx("h3",{className:"pt-4 px-3 text-capitalize",children:r})}),e.jsx("div",{className:"col-12 d-flex flex-wrap",children:v?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{height:"50vh",width:"100vw"},children:e.jsx(T,{color:"#00BFFF",height:50,width:50})}):N.length>0?N.map((n,x)=>e.jsx(J,{Usersdata:n,token:g},n._id)):e.jsx("h6",{className:"pt-3 px-3",children:C})})]})})}),e.jsx(k,{})]})};export{H as default};
