import{r as t,U as y,j as e,A as v,d as E,P as W,h as B,c as m,B as x}from"./index-CDisOkul.js";const u="https://ees121.com",R=()=>{const{user:s}=t.useContext(y),[r,j]=t.useState(0),[S,w]=t.useState([]),[b,p]=t.useState(0),[d,c]=t.useState(!0),[g,o]=t.useState("");t.useEffect(()=>{(async()=>{var i,f;if(!(s!=null&&s._id)){o("User is not authenticated"),c(!1);return}try{const a=await m.get(`${u}/referal/getUserWalletBalance/${s._id}`);console.log(a.data,"wallete"),j(a.data.walletBalance),w(a.data.earningsHistory||[])}catch(a){o(((f=(i=a==null?void 0:a.response)==null?void 0:i.data)==null?void 0:f.message)||"Error fetching wallet balance")}finally{c(!1)}})()},[s==null?void 0:s._id]);const N=async()=>{if(console.log(r,"walletBalance"),r<120){x.warning("Minimum withdrawal amount is ₹120");return}try{x.info("Withdrawal request submitted")}catch(l){console.error("[ERROR] Withdrawal failed:",l),x.error("Failed to process withdrawal")}};return t.useEffect(()=>{let l=!0;const i=new AbortController;return(async()=>{var a,h;if(s!=null&&s._id)try{c(!0);const n=await m.get(`${u}/referal/earnings/${s._id}`,{signal:i.signal});l&&n.status===200&&(p(n.data.earnings),o(null))}catch(n){l&&(console.error("[ERROR] Failed to fetch earnings:",n),m.isCancel(n)||(o(((h=(a=n.response)==null?void 0:a.data)==null?void 0:h.message)||"Failed to fetch earnings"),x.error("Error loading earnings data.")))}finally{l&&c(!1)}})(),()=>{l=!1,i.abort()}},[s==null?void 0:s._id]),e.jsxs(e.Fragment,{children:[e.jsx(v,{}),e.jsx(E,{}),e.jsx(W,{}),e.jsx("div",{className:"mt-40",children:e.jsx("div",{className:"container",children:e.jsx("section",{className:"",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"wallete px-0",children:e.jsx("div",{className:"w-full flex flex-col items-center justify-center p-6 my-5 bg-red-100 rounded-lg shadow-md",children:d?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})})}):g?e.jsx("div",{className:"w-full text-center p-3 bg-red-200 text-red-800 rounded-lg",children:g}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full flex justify-end mb-4",children:e.jsx("button",{className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md disabled:bg-gray-400",onClick:N,disabled:!0,children:d?"Loading...":`Withdraw ₹${r>=120?r:0}`})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Wallet Balance"}),d?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-blue-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-blue-600",children:["₹",r||0]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Earnings"}),d?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-green-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-green-600",children:["₹",b||0]})]})]})]})})})})})})}),e.jsx(B,{})]})},F=t.memo(R);export{F as default};
