import{r as t,U as N,j as e,c as u,B as h,A as w,e as v,f as b,h as E}from"./index-BTSmBB4g.js";const W="http://localhost:4000",S=({walletBalance:s})=>{const{user:a}=t.useContext(N),[m,f]=t.useState(0),[d,x]=t.useState([]),[i,g]=t.useState(!0),[c,o]=t.useState(null);t.useEffect(()=>{let l=!0;const j=new AbortController;return(async()=>{var p,y;if(a!=null&&a._id)try{g(!0);const r=await u.get(`${W}/referal/earnings/${a._id}`,{timeout:1e4,signal:j.signal});l&&r.status===200&&(f(r.data.earnings),x(r.data.earningsHistory||[]),o(null))}catch(r){l&&(console.error("[ERROR] Failed to fetch earnings:",r),u.isCancel(r)?console.log("Request cancelled"):(o(((y=(p=r.response)==null?void 0:p.data)==null?void 0:y.message)||"Failed to fetch earnings"),h.error("Error loading earnings data. Retrying...")))}finally{l&&g(!1)}})(),()=>{l=!1,j.abort()}},[a==null?void 0:a._id]);const n=async()=>{if(console.log(s,"walletBalance"),s<120){h.warning("Minimum withdrawal amount is ₹120");return}try{h.info("Withdrawal request submitted")}catch(l){console.error("[ERROR] Withdrawal failed:",l),h.error("Failed to process withdrawal")}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"col-4 col-md-4 d-flex align-items-center justify-content-center",children:e.jsx("div",{className:"card w-100 rounded-1 border-0 shadow-xl p-2 py-3",children:e.jsxs("div",{className:"d-flex flex-column gap-3 align-items-center justify-content-center",children:[e.jsx("span",{className:"text-capitalize",children:"Total"}),e.jsxs("h3",{children:["₹",s||0]})]})})}),e.jsx("div",{className:"col-4 col-md-4 d-flex align-items-center justify-content-center p-1",children:e.jsx("div",{className:"card w-100 rounded-1 border-0 shadow-xl p-2 py-3",children:e.jsxs("div",{className:"d-flex flex-column gap-3 align-items-center justify-content-center",children:[e.jsx("span",{className:"text-capitalize",children:"Earnings"}),e.jsxs("h3",{children:["₹",m||0]})]})})}),e.jsx("div",{className:"col-4 col-md-4 d-flex align-items-center justify-content-center",children:e.jsx("div",{className:"card w-100 rounded-1 border-0 shadow-xl p-2 py-3 cursor-pointer",children:e.jsxs("button",{className:"d-flex flex-column gap-3 align-items-center justify-content-center",onClick:n,disabled:s<120||i,children:[e.jsx("span",{className:"text-capitalize",children:i?"Loading...":"Withdraw"}),e.jsxs("h3",{children:["₹",s>=120?s:0]})]})})}),c&&e.jsx("div",{className:"col-12 mt-3",children:e.jsx("div",{className:"alert alert-danger text-center",children:c})})]})},R="http://localhost:4000",_=()=>{const{user:s}=t.useContext(N),[a,m]=t.useState(0);t.useState([]);const[f,d]=t.useState(!0),[x,i]=t.useState("");return t.useEffect(()=>{(async()=>{var c,o;if(!(s!=null&&s._id)){i("User is not authenticated"),d(!1);return}try{const n=await u.get(`${R}/referal/getUserWalletBalance/${s._id}`);console.log(n.data,"wallete"),m(n.data.walletBalance),d(!1)}catch(n){i(((o=(c=n==null?void 0:n.response)==null?void 0:c.data)==null?void 0:o.message)||"Error fetching wallet balance")}finally{d(!1)}})()},[s==null?void 0:s._id]),e.jsxs(e.Fragment,{children:[e.jsx(w,{}),e.jsx(v,{}),e.jsx(b,{}),e.jsx("div",{className:"my-32",children:e.jsx("section",{children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"wallete text-white",children:e.jsx("div",{className:"col-12 d-flex flex-wrap p-4 rounded-1 bg-blue align-items-center",children:f?e.jsx("div",{children:e.jsx("div",{className:"spinner-border text-light",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})})}):x?e.jsx("div",{className:"alert alert-danger",children:x}):e.jsx(S,{walletBalance:a})})})})})})}),e.jsx(E,{})]})},$=t.memo(_);export{$ as default};
