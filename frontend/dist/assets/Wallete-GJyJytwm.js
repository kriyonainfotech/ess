import{r as l,U as v,j as e,A as E,e as W,f as B,k as S,c as f,B as x}from"./index-CBkbb6rS.js";const j="https://ees121.com",R=()=>{const{user:t}=l.useContext(v),[n,w]=l.useState(0),[g,b]=l.useState([]),[p,N]=l.useState(0),[i,o]=l.useState(!0),[h,m]=l.useState("");l.useEffect(()=>{(async()=>{var r,c;if(!(t!=null&&t._id)){m("User is not authenticated"),o(!1);return}try{const a=await f.get(`${j}/referal/getUserWalletBalance/${t._id}`);console.log(a.data,"wallete"),w(a.data.walletBalance),b(a.data.earningsHistory||[])}catch(a){m(((c=(r=a==null?void 0:a.response)==null?void 0:r.data)==null?void 0:c.message)||"Error fetching wallet balance")}finally{o(!1)}})()},[t==null?void 0:t._id]);const y=async()=>{if(console.log(n,"walletBalance"),n<120){x.warning("Minimum withdrawal amount is ₹120");return}try{x.info("Withdrawal request submitted")}catch(s){console.error("[ERROR] Withdrawal failed:",s),x.error("Failed to process withdrawal")}};return l.useEffect(()=>{let s=!0;const r=new AbortController;return(async()=>{var a,u;if(t!=null&&t._id)try{o(!0);const d=await f.get(`${j}/referal/earnings/${t._id}`,{signal:r.signal});s&&d.status===200&&(N(d.data.earnings),m(null))}catch(d){s&&(console.error("[ERROR] Failed to fetch earnings:",d),f.isCancel(d)||(m(((u=(a=d.response)==null?void 0:a.data)==null?void 0:u.message)||"Failed to fetch earnings"),x.error("Error loading earnings data.")))}finally{s&&o(!1)}})(),()=>{s=!1,r.abort()}},[t==null?void 0:t._id]),e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsx(W,{}),e.jsx(B,{}),e.jsx("div",{className:"mt-40",children:e.jsx("div",{className:"container",children:e.jsx("section",{className:"",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"wallete px-0",children:e.jsx("div",{className:"w-full flex flex-col items-center justify-center p-6 mt-5 bg-red-100 rounded-lg shadow-md",children:i?e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("div",{className:"spinner-border text-danger",role:"status",children:e.jsx("span",{className:"sr-only",children:"Loading..."})})}):h?e.jsx("div",{className:"w-full text-center p-3 bg-red-200 text-red-800 rounded-lg",children:h}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-full flex justify-end mb-4",children:e.jsx("button",{className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold rounded-lg shadow-md disabled:bg-gray-400",onClick:y,disabled:n<120||i,children:i?"Loading...":`Withdraw ₹${n>=120?n:0}`})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 w-full",children:[e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Wallet Balance"}),i?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-blue-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-blue-600",children:["₹",n||0]})]}),e.jsxs("div",{className:"bg-white p-6 rounded-xl shadow-lg flex flex-col items-center justify-center",children:[e.jsx("span",{className:"text-lg font-medium",children:"Total Earnings"}),i?e.jsx("div",{className:"animate-spin h-6 w-6 border-t-4 border-green-500 rounded-full mt-2"}):e.jsxs("h3",{className:"text-3xl font-bold text-green-600",children:["₹",p||0]})]})]})]})})}),!i&&!h&&g.length>0&&e.jsxs("div",{className:"col-12 mt-4 p-4 alert alert-warning p-4 rounded-lg shadow-md",children:[e.jsx("h4",{className:"text-center mb-3",children:"Earnings History"}),e.jsx("ul",{className:"list-group",children:g.map((s,r)=>{var c,a;return e.jsxs("li",{className:"list-group-item alert alert-warning d-flex justify-content-between  align-items-center bg-gray-800",children:[e.jsxs("p",{className:"text-md",children:[e.jsx("span",{children:(c=s==null?void 0:s.sourceUser)==null?void 0:c.name}),e.jsx("br",{}),e.jsx("span",{className:"text-sm",children:new Date((a=s==null?void 0:s.sourceUser)==null?void 0:a.createdAt).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})})]}),e.jsxs("p",{className:"text-black fw-bold",children:["₹",s.amount]})]},r)})})]})]})})})}),e.jsx(S,{})]})},_=l.memo(R);export{_ as default};
