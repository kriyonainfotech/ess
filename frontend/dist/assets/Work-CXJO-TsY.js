import{r,j as e,k as A,v as I,c as S,B as u,A as P,d as B,P as E,L as U,h as z}from"./index-CDisOkul.js";import{s as L,a as M}from"./startSilver-5oWuoMuE.js";import{f as _,S as J}from"./Senedrequest-lypnS66-.js";import{$ as O}from"./module-TGxC-lWm.js";import{k as w}from"./index-kAruC4nt.js";const $="https://ees121.com",q=({receivedRequest:c,setReceivedRequest:x})=>{console.log(c,"receivedRequest");const[i,p]=r.useState(null),[v,d]=r.useState(null),[j,f]=r.useState(0),m=JSON.parse(localStorage.getItem("token")),h=async(s,n,a)=>{console.log(s,a,n,"id, status, requestId");try{const o=a==="cancelled"?"cancelRequest":"updateRequestStatus",t=await S.post(`${$}/request/${o}`,{userId:s,requestId:n,status:a},{headers:{Authorization:`Bearer ${m}`}});console.log(t,"response"),t.status===200?(u.success(`Request ${a}`),d(a),x(R=>R.map(g=>g.requestId===n?{...g,status:a}:g))):u.error("Failed to update request")}catch(o){console.log(o,"error"),u.error("Failed to update request")}},y=s=>{p(s)},b=()=>{p(null),f(0)},N=async(s,n,a,o="")=>{if(console.log(s,n,a,o,"requestId, receiverId, ratingValue, comment"),!s||!n||!a){console.error("Missing rating data");return}try{const t=await S.post(`${$}/user/rate`,{requestId:s,receiverId:n,ratingValue:a,comment:o},{withCredentials:!0,headers:{Authorization:`Bearer ${m}`}});console.log("Rating submitted successfully:",t.data),t.status===200?(u.success(t.data.message||"Rating submitted successfully"),b()):u.error("Failed to submit rating")}catch(t){console.log("Error submitting rating:",t||t.message),u.error("Failed to submit rating")}},l=(s=0,n=10,a=!1)=>Array.from({length:n},(o,t)=>e.jsx("img",{src:t<s?L:M,alt:t<s?"Filled Star":"Empty Star",width:22,className:`cursor-pointer ${a?"hover:opacity-80":""}`,onClick:a?()=>f(t+1):void 0},t));return e.jsxs("div",{className:"mt-0",children:[e.jsx("section",{className:"",children:e.jsx("div",{className:"",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 mt-4",children:c!=null&&c.length?c.map((s,n)=>{var a,o,t;return e.jsxs("div",{title:s.status==="cancelled"?"Sender has cancelled the request.":s.status==="rejected"?"Receiver has rejected the request.":s.status==="completed"?"Request completed rate the user":s.status==="accepted"?"Request accepted contact the user":"",className:"bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden }",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{className:"w-full h-[400px] object-cover object-top",src:s.profilePic||A,alt:"Profile"}),e.jsx("span",{className:`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-semibold 
                                                     ${s.status==="accepted"?"bg-blue-500":s.status==="completed"?"bg-green-600":"bg-yellow-500"} text-white`,children:s.status||"Pending"})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-orange-600 font-semibold capitalize",children:((a=s.businessCategory)==null?void 0:a.join(", "))||"N/A"}),e.jsx("p",{className:"text-sm",children:_(new Date(s.date),"PPpp")})]}),e.jsx("h4",{className:"py-1 font-semibold text-lg",children:s.name||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email||"No email provided"}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("strong",{className:"pr-2",children:"User Rating:"}),l(((o=s==null?void 0:s.userrating)==null?void 0:o.value)||0,10),e.jsx("span",{className:"pl-2",children:((t=s==null?void 0:s.userrating)==null?void 0:t.value)||0})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-4 py-2 w-1/2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",onClick:()=>h(s.senderId,s.requestId,"accepted"),children:"Accept"}),e.jsx("button",{className:"px-4 py-2 w-1/2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",onClick:()=>h(s.senderId,s.requestId,"rejected"),children:"Reject"})]}),s.status==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${s.phone}`,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(I,{})," Contact Now"]}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",onClick:()=>h(s.senderId,s.requestId,"completed"),children:"Completed"})]}),s.status==="completed"&&e.jsx("button",{className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition",onClick:()=>y(s),children:"Rate User"})]})]})]},n)}):e.jsxs("div",{className:"col-span-3 text-center py-12",children:[e.jsx("h5",{children:"No Request Found"}),e.jsx("p",{className:"text-gray-500",children:"Your received requests will appear here."})]})})})}),i&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Rate ",i.name]}),e.jsx("div",{className:"flex justify-center mb-4",children:l(j,10,!0)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-400 text-white rounded-lg",onClick:b,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg",onClick:()=>N(i.requestId,i.senderId,j),children:"Submit"})]})]})})]})},C="https://ees121.com",Y=()=>{const c=JSON.parse(localStorage.getItem("token"))||null,[x,i]=r.useState([]),[p,v]=r.useState([]),[d,j]=r.useState("Sended Request"),[f,m]=r.useState(!0),[h,y]=r.useState(!1);r.useEffect(()=>{setTimeout(()=>y(!0),50)},[]),console.log(x,"receivedRequest");const b=[{id:1,name:"Sended Request"},{id:2,name:"Received Request"}],N=r.useCallback(async l=>{var n,a,o;if(!c){console.warn("⚠️ No authentication token found."),w.error("Authentication required!"),m(!1);return}m(!0);let s="";l==="Sended Request"?s=`${C}/request/getSentRequests`:s=`${C}/request/getReceivedRequests`;try{const t=await S.get(s,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`}});if(console.log(t.data,"response.data"),t.status===200&&t.data)if(l==="Sended Request"){const R=t.data.sendedRequests.sort((g,F)=>{const k={pending:1,accepted:2,completed:3,rated:4,rejected:5};return(k[g.status]||99)-(k[F.status]||99)});v(R)}else i(t.data.receivedRequests||[]);else w.error(((n=t==null?void 0:t.data)==null?void 0:n.message)||"Error fetching requests")}catch(t){console.log(t,"error"),w.error(((o=(a=t==null?void 0:t.response)==null?void 0:a.data)==null?void 0:o.message)||"Server error")}finally{m(!1)}},[c]);return r.useEffect(()=>{N(d)},[d,N]),h?e.jsxs(e.Fragment,{children:[e.jsx(P,{}),e.jsx(B,{}),e.jsx(E,{}),e.jsx("div",{className:"mt-40",children:e.jsx("section",{className:"bg-gray-50 py-5",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 d-flex gap-3",children:b.map(l=>e.jsx("div",{className:"receivReqBtn",children:e.jsx(U,{className:`btn rounded-lg ${d===l.name?"btn-success text-white":"bg-none border-black text-black"}`,onClick:()=>j(l.name),children:l.name})},l.id))}),e.jsx("div",{className:"mt-0",children:f?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"300px"},children:e.jsx(O,{color:"#00BFFF",height:50,width:50})}):d==="Received Request"?e.jsx(q,{receivedRequest:x,setReceivedRequest:i}):e.jsx(J,{sendedRequest:p,setSendedRequest:v})})]})})})}),e.jsx(z,{})]}):null};export{Y as default};
