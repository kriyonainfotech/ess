import{r,u as Y,j as e,P as J,L as h,B as c,c as k,A as G,e as M,f as K,h as Q}from"./index-DNZyEJeY.js";import{s as H,a as T}from"./startSilver-5oWuoMuE.js";import{f as V,S as X}from"./Senedrequest-BaO-mY88.js";import{$ as Z}from"./module-CTDcpqXW.js";const W="https://ess-eta.vercel.app",v=({recievedRequest:u,setRecievedRequest:g})=>{const[w,m]=r.useState(""),[R,p]=r.useState(""),j=JSON.parse(localStorage.getItem("token"));Y(),r.useState(""),r.useState("");const[C,F]=r.useState(!1),S=(s,o=5)=>{const l=s.length>0?s.reduce((t,n)=>t+n.rating,0)/s.length:0,a=[];for(let t=1;t<=o;t++)a.push(e.jsx("img",{src:t<=l?H:T,alt:t<=l?"Filled Star":"Empty Star",width:15},t));return a},f=async s=>{c.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to Accept this Request?"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>q(s),children:"Yes"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:c.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},q=async s=>{var o,l,a;c.dismiss(),console.log("hello"),F(!0);try{const t=await k.post(`${W}/request/receivedRequest`,{senderId:s},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`}});t.status===200?(m("received"),g(n=>n.map(d=>d.user._id===s?{...d,status:"received"}:d)),c.success(((o=t==null?void 0:t.data)==null?void 0:o.message)||"Request accepted successfully")):(console.error("Failed to accept request:",t.data.message),c.error(t.data.message||"Failed to accept request."))}catch(t){console.error("Error accepting user request:",t),c((a=(l=t==null?void 0:t.response)==null?void 0:l.data)==null?void 0:a.message)}},b=async s=>{c.info(e.jsxs("div",{children:[e.jsx("p",{children:"Are you sure you want to cancel this Request?"}),e.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[e.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>i(s),children:"Yes"}),e.jsx("button",{className:"btn btn-secondary btn-sm",onClick:c.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},i=async s=>{var o,l,a,t;c.dismiss();try{const n=await k.post(`${W}/request/cancelRequest`,{senderId:s},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`}});n.status===200?(m("canceled"),c.success(((l=(o=error==null?void 0:error.response)==null?void 0:o.data)==null?void 0:l.message)||"Request canceled successfully."),g(d=>d.map(x=>x.user._id===s?{...x,status:"canceled"}:x))):(console.error("Failed to cancel request:",n.data.message),c.error(n.data.message||"Failed to cancel request."))}catch(n){console.error("Error canceling user request:",n),c((t=(a=n==null?void 0:n.response)==null?void 0:a.data)==null?void 0:t.message)}};r.useEffect(()=>{[...u].forEach(o=>{o.status==="received"?m("received"):o.status==="canceled"?m("canceled"):o.status==="pending"&&m("pending")})},[u]);const N=async s=>{p(s)},y=(s=0,o=10)=>{const l=[];for(let a=1;a<=o;a++)a<=s?l.push(e.jsx("img",{src:H,alt:"Filled Star",width:15},a)):a-.5<=s?l.push(e.jsx("img",{src:starHalf,alt:"Half Star",width:15},a)):l.push(e.jsx("img",{src:T,alt:"Empty Star",width:15},a));return l};return console.log(u,"recieved"),e.jsx(e.Fragment,{children:e.jsx("div",{className:"mt-4",children:e.jsx("section",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-12 mb-6",children:e.jsx("h2",{className:"text-2xl font-bold text-gray-800 border-b-2 border-orange-500 pb-2",children:"Received Requests"})}),e.jsx("div",{className:"col-12",children:e.jsx("div",{className:"row g-4",children:u.length?u.map((s,o)=>{var l,a,t,n,d,x,A,$,P,E,B,D,_,I,z,L,O,U;return e.jsx("div",{className:"col-12 col-md-6 col-xl-4",children:e.jsxs("div",{className:"bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden h-full flex flex-col",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{className:"w-full h-96 object-cover object-top",src:((l=s==null?void 0:s.user)==null?void 0:l.profilePic)||J,alt:"Profile"}),e.jsx("span",{className:`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-semibold ${s.status==="done"?"bg-red-500":"bg-green-600"} text-white`,children:s.status==="done"?"Completed":(a=s==null?void 0:s.user)==null?void 0:a.userstatus})]}),e.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[e.jsxs("div",{className:"d-flex justify-content-between capitalize ",children:[e.jsx("h6",{className:"text-orange m-0 text-md",children:s.user.businessCategory}),e.jsx("p",{className:"text-sm",children:V(new Date(s.date),"PPpp")})]}),e.jsxs("div",{className:"flex-column pt-2 text-start",children:[e.jsx("h4",{className:"py-1",children:s.user.name}),e.jsxs("p",{className:"d-flex align-items-center gap-2 pt-2",children:[(n=(t=s==null?void 0:s.user)==null?void 0:t.address)==null?void 0:n.area," ",(x=(d=s==null?void 0:s.user)==null?void 0:d.address)==null?void 0:x.city," ",($=(A=s==null?void 0:s.user)==null?void 0:A.address)==null?void 0:$.state," ",(E=(P=s==null?void 0:s.user)==null?void 0:P.address)==null?void 0:E.country," ",(D=(B=s==null?void 0:s.user)==null?void 0:B.address)==null?void 0:D.pincode]}),e.jsx("div",{className:"rating rating-sm w-full d-flex flex-column",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("strong",{className:"pe-2",children:"User:"}),S(((_=s==null?void 0:s.user)==null?void 0:_.userRatings)||[],10),e.jsx("span",{className:"ps-2",children:(z=(I=s==null?void 0:s.user)==null?void 0:I.userRatings)!=null&&z.length?(L=s==null?void 0:s.user)==null?void 0:L.userRatings[0].rating:0})]})}),s.status==="done"?e.jsx("div",{className:"rating rating-sm d-flex flex-column",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"pe-2",children:e.jsx("strong",{children:"Provider:"})}),e.jsx("div",{children:(O=s==null?void 0:s.userrating)!=null&&O.value?e.jsxs("div",{className:"d-flex align-items-center",children:[y(s==null?void 0:s.userrating.value,10),e.jsx("span",{className:"ps-2",children:((U=s==null?void 0:s.userrating)==null?void 0:U.value.toFixed(1))||0})]}):e.jsx("span",{children:"No ratings yet."})})]})}):e.jsx("div",{className:"pt-2 d-flex justify-content-between align-items-start w-100",children:s.status==="received"?e.jsxs(e.Fragment,{children:[e.jsx(h,{to:`tel:${s.user.phone}`,className:"btn p-2 w-50 border-green rounded-1 text-semibold text-green btn-outline-orange m-1",children:"Contact Now"}),e.jsx(h,{onClick:()=>N(s.user._id),className:"btn p-2 w-50 m-1 border-green rounded-1 text-semibold text-green btn-outline-orange","data-bs-toggle":"modal","data-bs-target":"#exampleModal",children:"Work Done"})]}):e.jsxs(e.Fragment,{children:[e.jsx(h,{onClick:()=>f(s.user._id),className:"btn p-2 w-50 border-orange rounded-1 text-semibold text-orange m-1 btn-outline-orange",children:"Accept"}),e.jsx(h,{onClick:()=>b(s.user._id),className:"btn p-2 w-50 m-1 border-orange rounded-1 text-semibold text-orange btn-outline-orange",children:"Cancel"})]})})]})]})]})},o)}):e.jsxs("div",{className:"col-12 text-center py-12",children:[e.jsx("h5",{children:"No Request Found for you"}),e.jsx("p",{className:"text-gray-500",children:"Your Received requests will appear here once you make them"})]})})})]})})})})})},ss="https://ess-eta.vercel.app",ls=()=>{const u=JSON.parse(localStorage.getItem("token")),[g,w]=r.useState([]),[m,R]=r.useState([]),[p,j]=r.useState("Sended Request"),[C,F]=r.useState(!0),[S,f]=r.useState(!0),q=[{id:1,name:"Sended Request"},{id:2,name:"Received Request"}],b=r.useCallback(async()=>{var i,N,y;try{const s=await k.get(`${ss}/request/getUserRequests`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}});if(console.log(s,"req"),s.status===200){const{receivedRequests:o,sendedRequests:l}=s.data,a=(o||[]).sort((n,d)=>new Date(d.date)-new Date(n.date)),t=(l||[]).sort((n,d)=>new Date(d.date)-new Date(n.date));w(a),R(t),f(!1)}else console.error("Failed to fetch requests:",s.data.message),toast((i=s==null?void 0:s.data)==null?void 0:i.message)}catch(s){console.error("Error fetching user requests:",s),toast((y=(N=s==null?void 0:s.response)==null?void 0:N.data)==null?void 0:y.message),f(!1)}},[u]);return r.useEffect(()=>{b()},[b]),e.jsxs(e.Fragment,{children:[e.jsx(G,{}),e.jsx(M,{}),e.jsx(K,{}),e.jsxs("div",{className:"my-32",children:[e.jsx("section",{className:"",children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12 d-flex gap-3",children:q.map(i=>e.jsx("div",{className:"receivReqBtn",children:e.jsx(h,{className:`btn rounded-lg ${p===i.name?"btn-success text-white":"bg-none border-black text-black"}`,onClick:()=>j(i.name),children:i.name})},i.id))})})})}),e.jsx("div",{className:"mt-4",children:S?e.jsxs("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"300px"},children:[e.jsx(Z,{color:"#00BFFF",height:50,width:50}),"  "]}):p==="Received Request"?e.jsx(v,{recievedRequest:g,setRecievedRequest:w}):e.jsx(X,{sendedRequest:m,setSendedRequest:R,isReceiverAvailable:C})})]}),e.jsx(Q,{})]})};export{ls as default};
