import{r as o,u as J,j as s,P as G,L as h,B as c,c as C,A as M,e as K,f as Q,h as V}from"./index-DaZyjPYF.js";import{s as T,a as W}from"./startSilver-5oWuoMuE.js";import{f as X,S as Z}from"./Senedrequest-CCYonzsy.js";import{$ as v}from"./module-pzzDOAjr.js";import{k}from"./index-InlIt2Lv.js";const Y="https://ees121.com",ss=({recievedRequest:u,setRecievedRequest:g})=>{const[w,x]=o.useState(""),[R,p]=o.useState(""),j=JSON.parse(localStorage.getItem("token"));J(),o.useState(""),o.useState("");const[F,A]=o.useState(!1),S=(e,t=5)=>{const l=e.length>0?e.reduce((a,r)=>a+r.rating,0)/e.length:0,n=[];for(let a=1;a<=t;a++)n.push(s.jsx("img",{src:a<=l?T:W,alt:a<=l?"Filled Star":"Empty Star",width:15},a));return n},f=async e=>{c.info(s.jsxs("div",{children:[s.jsx("p",{children:"Are you sure you want to Accept this Request?"}),s.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[s.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>q(e),children:"Yes"}),s.jsx("button",{className:"btn btn-secondary btn-sm",onClick:c.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},q=async e=>{var t,l,n;c.dismiss(),console.log("hello"),A(!0);try{const a=await C.post(`${Y}/request/receivedRequest`,{senderId:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`}});a.status===200?(x("received"),g(r=>r.map(d=>d.user._id===e?{...d,status:"received"}:d)),c.success(((t=a==null?void 0:a.data)==null?void 0:t.message)||"Request accepted successfully")):(console.error("Failed to accept request:",a.data.message),c.error(a.data.message||"Failed to accept request."))}catch(a){console.error("Error accepting user request:",a),c((n=(l=a==null?void 0:a.response)==null?void 0:l.data)==null?void 0:n.message)}},b=async e=>{c.info(s.jsxs("div",{children:[s.jsx("p",{children:"Are you sure you want to cancel this Request?"}),s.jsxs("div",{className:"d-flex justify-content-center gap-2",children:[s.jsx("button",{className:"btn btn-danger btn-sm",onClick:()=>m(e),children:"Yes"}),s.jsx("button",{className:"btn btn-secondary btn-sm",onClick:c.dismiss,children:"No"})]})]}),{autoClose:!0,closeOnClick:!0})},m=async e=>{var t,l,n,a;c.dismiss();try{const r=await C.post(`${Y}/request/cancelRequest`,{senderId:e},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${j}`}});r.status===200?(x("canceled"),c.success(((l=(t=error==null?void 0:error.response)==null?void 0:t.data)==null?void 0:l.message)||"Request canceled successfully."),g(d=>d.map(i=>i.user._id===e?{...i,status:"canceled"}:i))):(console.error("Failed to cancel request:",r.data.message),c.error(r.data.message||"Failed to cancel request."))}catch(r){console.error("Error canceling user request:",r),c((a=(n=r==null?void 0:r.response)==null?void 0:n.data)==null?void 0:a.message)}};o.useEffect(()=>{[...u].forEach(t=>{t.status==="received"?x("received"):t.status==="canceled"?x("canceled"):t.status==="pending"&&x("pending")})},[u]);const N=async e=>{p(e)},y=(e=0,t=10)=>{const l=[];for(let n=1;n<=t;n++)n<=e?l.push(s.jsx("img",{src:T,alt:"Filled Star",width:15},n)):n-.5<=e?l.push(s.jsx("img",{src:starHalf,alt:"Half Star",width:15},n)):l.push(s.jsx("img",{src:W,alt:"Empty Star",width:15},n));return l};return console.log(u,"recieved"),s.jsx(s.Fragment,{children:s.jsx("div",{className:"mt-4",children:s.jsx("section",{className:"bg-gray-50 p-4 rounded-lg",children:s.jsx("div",{className:"container",children:s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-12 mb-6",children:s.jsx("h2",{className:"text-2xl font-bold text-gray-800 border-b-2 border-orange-500 pb-2",children:"Received Requests"})}),s.jsx("div",{className:"col-12",children:s.jsx("div",{className:"row g-4",children:u.length?u.map((e,t)=>{var l,n,a,r,d,i,$,P,E,I,B,D,_,O,z,L,U,H;return s.jsx("div",{className:"col-12 col-md-6 col-xl-4",children:s.jsxs("div",{className:"bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden h-full flex flex-col",children:[s.jsxs("div",{className:"relative",children:[s.jsx("img",{className:"w-full h-96 object-cover object-top",src:((l=e==null?void 0:e.user)==null?void 0:l.profilePic)||G,alt:"Profile"}),s.jsx("span",{className:`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-semibold ${e.status==="done"?"bg-red-500":"bg-green-600"} text-white`,children:e.status==="done"?"Completed":(n=e==null?void 0:e.user)==null?void 0:n.userstatus})]}),s.jsxs("div",{className:"p-4 flex-1 flex flex-col",children:[s.jsxs("div",{className:"d-flex justify-content-between capitalize ",children:[s.jsx("h6",{className:"text-orange m-0 text-md",children:e.user.businessCategory}),s.jsx("p",{className:"text-sm",children:X(new Date(e.date),"PPpp")})]}),s.jsxs("div",{className:"flex-column pt-2 text-start",children:[s.jsx("h4",{className:"py-1",children:e.user.name}),s.jsxs("p",{className:"d-flex align-items-center gap-2 pt-2",children:[(r=(a=e==null?void 0:e.user)==null?void 0:a.address)==null?void 0:r.area," ",(i=(d=e==null?void 0:e.user)==null?void 0:d.address)==null?void 0:i.city," ",(P=($=e==null?void 0:e.user)==null?void 0:$.address)==null?void 0:P.state," ",(I=(E=e==null?void 0:e.user)==null?void 0:E.address)==null?void 0:I.country," ",(D=(B=e==null?void 0:e.user)==null?void 0:B.address)==null?void 0:D.pincode]}),s.jsx("div",{className:"rating rating-sm w-full d-flex flex-column",children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("strong",{className:"pe-2",children:"User:"}),S(((_=e==null?void 0:e.user)==null?void 0:_.userRatings)||[],10),s.jsx("span",{className:"ps-2",children:(z=(O=e==null?void 0:e.user)==null?void 0:O.userRatings)!=null&&z.length?(L=e==null?void 0:e.user)==null?void 0:L.userRatings[0].rating:0})]})}),e.status==="done"?s.jsx("div",{className:"rating rating-sm d-flex flex-column",children:s.jsxs("div",{className:"d-flex align-items-center",children:[s.jsx("div",{className:"pe-2",children:s.jsx("strong",{children:"Provider:"})}),s.jsx("div",{children:(U=e==null?void 0:e.userrating)!=null&&U.value?s.jsxs("div",{className:"d-flex align-items-center",children:[y(e==null?void 0:e.userrating.value,10),s.jsx("span",{className:"ps-2",children:((H=e==null?void 0:e.userrating)==null?void 0:H.value.toFixed(1))||0})]}):s.jsx("span",{children:"No ratings yet."})})]})}):s.jsx("div",{className:"pt-2 d-flex justify-content-between align-items-start w-100",children:e.status==="received"?s.jsxs(s.Fragment,{children:[s.jsx(h,{to:`tel:${e.user.phone}`,className:"btn p-2 w-50 border-green rounded-1 text-semibold text-green btn-outline-orange m-1",children:"Contact Now"}),s.jsx(h,{onClick:()=>N(e.user._id),className:"btn p-2 w-50 m-1 border-green rounded-1 text-semibold text-green btn-outline-orange","data-bs-toggle":"modal","data-bs-target":"#exampleModal",children:"Work Done"})]}):s.jsxs(s.Fragment,{children:[s.jsx(h,{onClick:()=>f(e.user._id),className:"btn p-2 w-50 border-orange rounded-1 text-semibold text-orange m-1 btn-outline-orange",children:"Accept"}),s.jsx(h,{onClick:()=>b(e.user._id),className:"btn p-2 w-50 m-1 border-orange rounded-1 text-semibold text-orange btn-outline-orange",children:"Cancel"})]})})]})]})]})},t)}):s.jsxs("div",{className:"col-12 text-center py-12",children:[s.jsx("h5",{children:"No Request Found for you"}),s.jsx("p",{className:"text-gray-500",children:"Your Received requests will appear here once you make them"})]})})})]})})})})})},es="https://ees121.com",os=()=>{const u=JSON.parse(localStorage.getItem("token"))||null,[g,w]=o.useState([]),[x,R]=o.useState([]),[p,j]=o.useState("Sended Request"),[F,A]=o.useState(!0),[S,f]=o.useState(!0),q=[{id:1,name:"Sended Request"},{id:2,name:"Received Request"}],b=o.useCallback(async()=>{var m,N,y,e;if(!u){console.warn("⚠️ No authentication token found."),k.error("Authentication required!"),f(!1);return}try{const t=await C.get(`${es}/request/getUserRequests`,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${u}`}});if(console.log("[INFO] API Response:",t),t.status===200&&t.data){const{receivedRequests:l=[],sendedRequests:n=[]}=t.data,a=l.sort((d,i)=>new Date(i.date)-new Date(d.date)),r=n.sort((d,i)=>new Date(i.date)-new Date(d.date));w(a),R(r)}else console.error("Failed to fetch requests:",(m=t.data)==null?void 0:m.message),k.error(((N=t==null?void 0:t.data)==null?void 0:N.message)||"Error fetching requests")}catch(t){console.error("Error fetching user requests:",t),k.error(((e=(y=t==null?void 0:t.response)==null?void 0:y.data)==null?void 0:e.message)||"Server error")}finally{f(!1)}},[u]);return o.useEffect(()=>{b()},[b]),s.jsxs(s.Fragment,{children:[s.jsx(M,{}),s.jsx(K,{}),s.jsx(Q,{}),s.jsxs("div",{className:"my-32",children:[s.jsx("section",{children:s.jsx("div",{className:"container",children:s.jsx("div",{className:"row",children:s.jsx("div",{className:"col-12 d-flex gap-3",children:q.map(m=>s.jsx("div",{className:"receivReqBtn",children:s.jsx(h,{className:`btn rounded-lg ${p===m.name?"btn-success text-white":"bg-none border-black text-black"}`,onClick:()=>j(m.name),children:m.name})},m.id))})})})}),s.jsx("div",{className:"mt-4",children:S?s.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"300px"},children:s.jsx(v,{color:"#00BFFF",height:50,width:50})}):p==="Received Request"?s.jsx(ss,{recievedRequest:g,setRecievedRequest:w}):s.jsx(Z,{sendedRequest:x,setSendedRequest:R,isReceiverAvailable:F})})]}),s.jsx(V,{})]})};export{os as default};
