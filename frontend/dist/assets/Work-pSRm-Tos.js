import{r as o,j as e,P as C,v as A,c as w,B as m,A as F,e as I,f as P,L as q,k as B}from"./index-FUZ0JNie.js";import{s as E,a as U}from"./startSilver-5oWuoMuE.js";import{f as z,S as L}from"./Senedrequest-5TiZZtD2.js";import{$ as M}from"./module-DcP4xYGf.js";import{k as y}from"./index-_cH-tkpp.js";const S="https://ees121.com",_=({receivedRequest:l,setReceivedRequest:p})=>{console.log(l,"receivedRequest");const[c,j]=o.useState(null),[v,i]=o.useState(null),[b,f]=o.useState(0),u=JSON.parse(localStorage.getItem("token")),g=async(s,a,t)=>{console.log(s,t,a,"id, status, requestId");try{const d=t==="cancelled"?"cancelRequest":"updateRequestStatus",n=await w.post(`${S}/request/${d}`,{userId:s,requestId:a,status:t},{headers:{Authorization:`Bearer ${u}`}});console.log(n,"response"),n.status===200?(m.success(`Request ${t}`),i(t),p($=>$.map(R=>R.requestId===a?{...R,status:t}:R))):m.error("Failed to update request")}catch(d){console.log(d,"error"),m.error("Failed to update request")}},N=s=>{j(s)},r=()=>{j(null),f(0)},h=async(s,a,t,d="")=>{if(console.log(s,a,t,d,"requestId, receiverId, ratingValue, comment"),!s||!a||!t){console.error("Missing rating data");return}try{const n=await w.post(`${S}/user/rate`,{requestId:s,receiverId:a,ratingValue:t,comment:d},{withCredentials:!0,headers:{Authorization:`Bearer ${u}`}});console.log("Rating submitted successfully:",n.data),n.status===200?(m.success(n.data.message||"Rating submitted successfully"),r()):m.error("Failed to submit rating")}catch(n){console.log("Error submitting rating:",n||n.message),m.error("Failed to submit rating")}},x=(s=0,a=10,t=!1)=>Array.from({length:a},(d,n)=>e.jsx("img",{src:n<s?E:U,alt:n<s?"Filled Star":"Empty Star",width:22,className:`cursor-pointer ${t?"hover:opacity-80":""}`,onClick:t?()=>f(n+1):void 0},n));return e.jsxs("div",{className:"mt-28",children:[e.jsx("section",{className:"bg-gray-50 p-4 rounded-lg",children:e.jsxs("div",{className:"container",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 border-b-2 border-orange-500 pb-2",children:"Received Requests"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 mt-4",children:l!=null&&l.length?l.map((s,a)=>{var t;return e.jsxs("div",{title:s.status==="cancelled"?"Sender has cancelled the request.":s.status==="rejected"?"Receiver has rejected the request.":s.status==="completed"?"Request completed rate the user":s.status==="accepted"?"Request accepted contact the user":"",className:`bg-white rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 overflow-hidden ${["rejected","cancelled"].includes(s.status)?"opacity-50 grayscale":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{className:"w-full h-64 object-cover object-top",src:s.profilePic||C,alt:"Profile"}),e.jsx("span",{className:`absolute top-4 right-4 px-3 py-1 rounded-full text-xs font-semibold 
                                                     ${s.status==="accepted"?"bg-blue-500":s.status==="completed"?"bg-green-600":"bg-yellow-500"} text-white`,children:s.status||"Pending"})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("p",{className:"text-orange-600 font-semibold capitalize",children:((t=s.businessCategory)==null?void 0:t.join(", "))||"N/A"}),e.jsx("p",{className:"text-sm",children:z(new Date(s.date),"PPpp")})]}),e.jsx("h4",{className:"py-1 font-semibold text-lg",children:s.name||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.email||"No email provided"}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx("strong",{className:"pr-2",children:"User Rating:"}),x(s.userAverageRating||0,10),e.jsx("span",{className:"pl-2",children:s.userAverageRating||0})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[s.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"px-4 py-2 w-1/2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition",onClick:()=>g(s.senderId,s.requestId,"accepted"),children:"Accept"}),e.jsx("button",{className:"px-4 py-2 w-1/2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition",onClick:()=>g(s.senderId,s.requestId,"rejected"),children:"Reject"})]}),s.status==="accepted"&&e.jsxs(e.Fragment,{children:[e.jsxs("a",{href:`tel:${s.phone}`,className:"flex-1 flex items-center justify-center gap-2 px-4 py-2 text-white bg-green-600 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(A,{})," Contact Now"]}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",onClick:()=>g(s.senderId,s.requestId,"completed"),children:"Completed"})]}),s.status==="completed"&&e.jsx("button",{className:"px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition",onClick:()=>N(s),children:"Rate User"})]})]})]},a)}):e.jsxs("div",{className:"col-span-3 text-center py-12",children:[e.jsx("h5",{children:"No Request Found"}),e.jsx("p",{className:"text-gray-500",children:"Your received requests will appear here."})]})})]})}),c&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",children:e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow-lg w-96",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4",children:["Rate ",c.name]}),e.jsx("div",{className:"flex justify-center mb-4",children:x(b,10,!0)}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-400 text-white rounded-lg",onClick:r,children:"Cancel"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded-lg",onClick:()=>h(c.requestId,c.senderId,b),children:"Submit"})]})]})})]})},k="https://ees121.com",W=()=>{const l=JSON.parse(localStorage.getItem("token"))||null,[p,c]=o.useState([]),[j,v]=o.useState([]),[i,b]=o.useState("Sended Request"),[f,u]=o.useState(!0);console.log(p,"receivedRequest");const g=[{id:1,name:"Sended Request"},{id:2,name:"Received Request"}],N=o.useCallback(async r=>{var x,s,a;if(!l){console.warn("⚠️ No authentication token found."),y.error("Authentication required!"),u(!1);return}u(!0);let h="";r==="Sended Request"?h=`${k}/request/getSentRequests`:h=`${k}/request/getReceivedRequests`;try{const t=await w.get(h,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${l}`}});console.log(t.data,"response.data"),t.status===200&&t.data?r==="Sended Request"?v(t.data.sendedRequests||[]):(c(t.data.receivedRequests||[]),console.log(t.data.receivedRequests,"response.data.receivedRequests")):y.error(((x=t==null?void 0:t.data)==null?void 0:x.message)||"Error fetching requests")}catch(t){console.log(t,"error"),y.error(((a=(s=t==null?void 0:t.response)==null?void 0:s.data)==null?void 0:a.message)||"Server error")}finally{u(!1)}},[l]);return o.useEffect(()=>{N(i)},[i,N]),e.jsxs(e.Fragment,{children:[e.jsx(F,{}),e.jsx(I,{}),e.jsx(P,{}),e.jsxs("div",{className:"my-40",children:[e.jsx("section",{children:e.jsx("div",{className:"container",children:e.jsx("div",{className:"row",children:e.jsx("div",{className:"col-12 d-flex gap-3",children:g.map(r=>e.jsx("div",{className:"receivReqBtn",children:e.jsx(q,{className:`btn rounded-lg ${i===r.name?"btn-success text-white":"bg-none border-black text-black"}`,onClick:()=>b(r.name),children:r.name})},r.id))})})})}),e.jsx("div",{className:"mt-4",children:f?e.jsx("div",{className:"d-flex justify-content-center align-items-center",style:{minHeight:"300px"},children:e.jsx(M,{color:"#00BFFF",height:50,width:50})}):i==="Received Request"?e.jsx(_,{receivedRequest:p,setReceivedRequest:c}):e.jsx(L,{sendedRequest:j,setSendedRequest:v})})]}),e.jsx(B,{})]})};export{W as default};
